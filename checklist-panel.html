<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Post-Panel | ExpertCell</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --att-blue: #00A8E1;
            --att-blue-dark: #0057B8;
            --att-blue-deeper: #003A70;
            --white: #FFFFFF;
            --gray-50: #F8FAFC;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-300: #CBD5E1;
            --gray-400: #94A3B8;
            --gray-500: #64748B;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1E293B;
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --danger: #EF4444;
            --danger-light: #FEE2E2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'IBM Plex Sans', sans-serif; background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%); min-height: 100vh; color: var(--gray-800); }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, var(--att-blue-dark) 0%, var(--att-blue-deeper) 100%); padding: 30px; border-radius: 16px; margin-bottom: 24px; box-shadow: 0 10px 40px rgba(0, 87, 184, 0.3); }
        .header h1 { color: var(--white); font-size: 24px; font-weight: 700; margin-bottom: 4px; }
        .header p { color: rgba(255,255,255,0.9); font-size: 14px; }
        .card { background: var(--white); border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); border: 1px solid var(--gray-200); }
        .card-title { font-size: 18px; font-weight: 600; color: var(--gray-800); margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .card-title .icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 18px; }
        .stats-bar { display: flex; gap: 16px; margin-bottom: 20px; }
        .stat-item { flex: 1; background: var(--gray-50); border-radius: 12px; padding: 16px; text-align: center; border: 2px solid var(--gray-200); }
        .stat-item.success { background: var(--success-light); border-color: var(--success); }
        .stat-item.warning { background: var(--warning-light); border-color: var(--warning); }
        .stat-item.neutral { background: var(--gray-100); border-color: var(--gray-300); }
        .stat-number { font-size: 28px; font-weight: 700; }
        .stat-item.success .stat-number { color: var(--success); }
        .stat-item.warning .stat-number { color: var(--warning); }
        .stat-item.neutral .stat-number { color: var(--gray-500); }
        .stat-label { font-size: 12px; color: var(--gray-600); margin-top: 4px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 14px; font-weight: 500; color: var(--gray-700); margin-bottom: 8px; }
        .form-group select { width: 100%; padding: 12px 16px; border: 2px solid var(--gray-200); border-radius: 10px; font-size: 15px; font-family: inherit; background: var(--white); cursor: pointer; }
        .form-group select:focus { outline: none; border-color: var(--att-blue); }
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; border: 2px solid var(--gray-200); border-radius: 10px; background: var(--white); font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; font-family: inherit; }
        .tab-btn:hover { border-color: var(--att-blue); }
        .tab-btn.active { background: var(--att-blue); border-color: var(--att-blue); color: white; }
        .tab-btn .badge { background: var(--gray-200); color: var(--gray-700); padding: 2px 8px; border-radius: 10px; font-size: 12px; }
        .tab-btn.active .badge { background: rgba(255,255,255,0.3); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .aspirante-list { display: flex; flex-direction: column; gap: 12px; }
        .aspirante-card { display: flex; align-items: center; padding: 16px; background: var(--gray-50); border: 2px solid var(--gray-200); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
        .aspirante-card:hover { border-color: var(--att-blue); background: white; }
        .aspirante-card.status-completo { border-color: var(--success); background: var(--success-light); }
        .aspirante-card.status-pendiente { border-color: var(--warning); background: var(--warning-light); }
        .aspirante-avatar { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; color: white; margin-right: 14px; }
        .status-completo .aspirante-avatar { background: linear-gradient(135deg, var(--success) 0%, #059669 100%); }
        .status-pendiente .aspirante-avatar { background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%); }
        .status-nuevo .aspirante-avatar { background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); }
        .aspirante-info { flex: 1; }
        .aspirante-info h4 { font-size: 15px; font-weight: 600; color: var(--gray-800); margin-bottom: 4px; }
        .aspirante-info p { font-size: 13px; color: var(--gray-500); }
        .aspirante-info .docs-pendientes { font-size: 12px; color: var(--warning); margin-top: 4px; font-weight: 500; }
        .aspirante-status { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-badge.completo { background: var(--success); color: white; }
        .status-badge.pendiente { background: var(--warning); color: white; }
        .status-badge.nuevo { background: var(--gray-400); color: white; }
        .btn-recordatorio { padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 600; background: var(--att-blue); color: white; border: none; cursor: pointer; display: flex; align-items: center; gap: 4px; font-family: inherit; }
        .btn-recordatorio:hover { background: var(--att-blue-dark); }
        .checklist-section { margin-bottom: 20px; }
        .checklist-section-title { font-size: 13px; font-weight: 600; color: var(--gray-600); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px; }
        .obligatorio-badge { background: var(--danger-light); color: var(--danger); padding: 2px 8px; border-radius: 4px; font-size: 10px; }
        .opcional-badge { background: var(--gray-100); color: var(--gray-500); padding: 2px 8px; border-radius: 4px; font-size: 10px; }
        .checklist-item { display: flex; align-items: center; justify-content: space-between; padding: 14px; background: var(--gray-50); border: 2px solid var(--gray-200); border-radius: 10px; margin-bottom: 8px; transition: all 0.2s; }
        .checklist-item:hover { border-color: var(--att-blue); }
        .checklist-item.checked { border-color: var(--success); background: var(--success-light); }
        .checklist-item.pending { border-color: var(--warning); background: var(--warning-light); }
        .checklist-item-left { display: flex; align-items: center; gap: 12px; }
        .checklist-item-icon { width: 36px; height: 36px; background: var(--gray-200); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .checklist-item.checked .checklist-item-icon { background: var(--success); color: white; }
        .checklist-item.pending .checklist-item-icon { background: var(--warning); color: white; }
        .checklist-item-text h4 { font-size: 14px; font-weight: 600; color: var(--gray-800); }
        .checklist-toggle { display: flex; gap: 6px; }
        .toggle-btn { padding: 8px 14px; border: 2px solid var(--gray-200); border-radius: 8px; background: white; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: inherit; }
        .toggle-btn:hover { border-color: var(--att-blue); }
        .toggle-btn.active-yes { background: var(--success); border-color: var(--success); color: white; }
        .toggle-btn.active-no { background: var(--warning); border-color: var(--warning); color: white; }
        .toggle-btn.active-na { background: var(--gray-400); border-color: var(--gray-400); color: white; }
        .contact-form { background: var(--gray-50); border-radius: 12px; padding: 16px; }
        .form-row { display: flex; gap: 12px; margin-bottom: 12px; }
        .form-row:last-child { margin-bottom: 0; }
        .form-row .form-group { flex: 1; margin-bottom: 0; }
        .form-row input, .form-row select { width: 100%; padding: 10px 12px; border: 2px solid var(--gray-200); border-radius: 8px; font-size: 14px; font-family: inherit; }
        .form-row input:focus, .form-row select:focus { outline: none; border-color: var(--att-blue); }
        .obs-textarea { width: 100%; padding: 12px; border: 2px solid var(--gray-200); border-radius: 10px; font-family: inherit; font-size: 14px; min-height: 70px; resize: vertical; }
        .obs-textarea:focus { outline: none; border-color: var(--att-blue); }
        .btn { padding: 14px 24px; border-radius: 10px; font-size: 15px; font-weight: 600; font-family: inherit; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); color: var(--white); box-shadow: 0 4px 15px rgba(0, 168, 225, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 168, 225, 0.4); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--gray-100); color: var(--gray-700); border: 2px solid var(--gray-200); }
        .btn-secondary:hover { border-color: var(--att-blue); }
        .btn-row { display: flex; gap: 12px; margin-top: 20px; }
        .btn-row .btn { flex: 1; }
        .loading { display: inline-block; width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: var(--white); animation: spin 0.8s linear infinite; }
        .loading-dark { border: 2px solid var(--gray-200); border-top-color: var(--att-blue); }
        @keyframes spin { to { transform: rotate(360deg); } }
        .section { display: none; }
        .section.active { display: block; }
        .confirmation-screen { text-align: center; padding: 50px 20px; }
        .confirmation-icon { width: 90px; height: 90px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 44px; color: var(--white); }
        .confirmation-icon.success { background: linear-gradient(135deg, var(--success) 0%, #059669 100%); }
        .confirmation-icon.pending { background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%); }
        .confirmation-screen h2 { font-size: 22px; color: var(--gray-800); margin-bottom: 10px; }
        .confirmation-screen p { color: var(--gray-500); margin-bottom: 8px; font-size: 15px; }
        .confirmation-screen .docs-list { background: var(--warning-light); border-radius: 10px; padding: 16px; margin: 20px 0; text-align: left; }
        .confirmation-screen .docs-list h4 { color: var(--warning); font-size: 14px; margin-bottom: 8px; }
        .confirmation-screen .docs-list ul { margin: 0; padding-left: 20px; color: var(--gray-700); font-size: 14px; }
        .empty-state { text-align: center; padding: 40px 20px; color: var(--gray-500); }
        .empty-state .icon { font-size: 48px; margin-bottom: 16px; }
        .empty-state h3 { color: var(--gray-700); margin-bottom: 8px; }
        .aspirante-header { display: flex; align-items: center; gap: 16px; padding: 20px; background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-radius: 12px; color: white; margin-bottom: 20px; }
        .aspirante-header .avatar { width: 56px; height: 56px; background: rgba(255,255,255,0.2); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 700; }
        .aspirante-header .info h3 { font-size: 18px; margin-bottom: 4px; }
        .aspirante-header .info p { opacity: 0.9; font-size: 14px; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: white; border-radius: 16px; padding: 24px; max-width: 400px; width: 90%; }
        .modal h3 { margin-bottom: 16px; }
        .modal p { color: var(--gray-600); margin-bottom: 20px; font-size: 14px; }
        .modal .btn-row { margin-top: 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Checklist Post-Panel</h1>
            <p>Documentaci√≥n y Psicom√©tricos | ExpertCell</p>
        </div>

        <div class="section active" id="section-seleccion">
            <div class="card">
                <div class="card-title"><div class="icon">üìç</div>Selecciona el Panel</div>
                <div class="form-group">
                    <label>Sucursal</label>
                    <select id="select-sucursal" onchange="onSucursalChange()">
                        <option value="">Selecciona sucursal...</option>
                        <option value="Torre JV Ju√°rez">üè¢ Torre JV Ju√°rez</option>
                        <option value="Edificio Inbursa Antequera">üèõÔ∏è Edificio Inbursa Antequera</option>
                    </select>
                </div>
                <div class="form-group" id="reclutador-group" style="display: none;">
                    <label>Reclutador</label>
                    <select id="select-reclutador" onchange="onReclutadorChange()">
                        <option value="">Selecciona reclutador...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fecha del Panel</label>
                    <select id="select-fecha" onchange="onFechaChange()" disabled>
                        <option value="">Primero selecciona sucursal...</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="btn-actualizar" style="display: none; margin-top: 10px;" onclick="actualizarLista()">üîÑ Actualizar Lista</button>
            </div>

            <div class="stats-bar" id="stats-bar" style="display: none;">
                <div class="stat-item success"><div class="stat-number" id="stat-completos">0</div><div class="stat-label">‚úÖ Completos</div></div>
                <div class="stat-item warning"><div class="stat-number" id="stat-pendientes">0</div><div class="stat-label">‚è≥ Pendientes</div></div>
                <div class="stat-item neutral"><div class="stat-number" id="stat-sin-iniciar">0</div><div class="stat-label">üìù Sin iniciar</div></div>
            </div>

            <div class="card" id="aspirantes-card" style="display: none;">
                <div class="card-title"><div class="icon">üë•</div>Aspirantes Aprobados</div>
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('pendientes')">‚è≥ Pendientes <span class="badge" id="tab-pendientes-count">0</span></button>
                    <button class="tab-btn" onclick="showTab('completos')">‚úÖ Completos <span class="badge" id="tab-completos-count">0</span></button>
                </div>
                <div class="tab-content active" id="tab-pendientes"><div class="aspirante-list" id="lista-pendientes"></div></div>
                <div class="tab-content" id="tab-completos"><div class="aspirante-list" id="lista-completos"></div></div>
            </div>
        </div>

        <div class="section" id="section-checklist">
            <div class="card">
                <div class="aspirante-header" id="aspirante-header">
                    <div class="avatar" id="aspirante-iniciales">JS</div>
                    <div class="info"><h3 id="aspirante-nombre">Nombre del Aspirante</h3><p id="aspirante-detalles">76/80 pts ‚Ä¢ Aprobado (muy bien)</p></div>
                </div>

                <div class="checklist-section">
                    <div class="checklist-section-title">üìå Documentos Obligatorios <span class="obligatorio-badge">REQUERIDOS</span></div>
                    <div class="checklist-item" id="item-ine"><div class="checklist-item-left"><div class="checklist-item-icon">ü™™</div><div class="checklist-item-text"><h4>INE</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('ine', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('ine', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-curp"><div class="checklist-item-left"><div class="checklist-item-icon">üìÑ</div><div class="checklist-item-text"><h4>CURP</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('curp', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('curp', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-domicilio"><div class="checklist-item-left"><div class="checklist-item-icon">üè†</div><div class="checklist-item-text"><h4>Comprobante de domicilio</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('domicilio', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('domicilio', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-acta"><div class="checklist-item-left"><div class="checklist-item-icon">üìú</div><div class="checklist-item-text"><h4>Acta de nacimiento</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('acta', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('acta', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-rfc"><div class="checklist-item-left"><div class="checklist-item-icon">üèõÔ∏è</div><div class="checklist-item-text"><h4>RFC</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('rfc', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('rfc', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-banco"><div class="checklist-item-left"><div class="checklist-item-icon">üí≥</div><div class="checklist-item-text"><h4>Datos bancarios</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('banco', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('banco', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-psico"><div class="checklist-item-left"><div class="checklist-item-icon">üß†</div><div class="checklist-item-text"><h4>Psicom√©tricos</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('psico', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('psico', false)">‚ùå No</button></div></div>
                </div>

                <div class="checklist-section">
                    <div class="checklist-section-title">üìé Documentos Opcionales <span class="opcional-badge">PUEDEN ENTREGARSE DESPU√âS</span></div>
                    <div class="checklist-item" id="item-csf"><div class="checklist-item-left"><div class="checklist-item-icon">üìã</div><div class="checklist-item-text"><h4>Constancia de Situaci√≥n Fiscal</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('csf', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('csf', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-estudios"><div class="checklist-item-left"><div class="checklist-item-icon">üéì</div><div class="checklist-item-text"><h4>Comprobante de estudios</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('estudios', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('estudios', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-laboral"><div class="checklist-item-left"><div class="checklist-item-icon">üíº</div><div class="checklist-item-text"><h4>Constancia laboral</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('laboral', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('laboral', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-nss"><div class="checklist-item-left"><div class="checklist-item-icon">üè•</div><div class="checklist-item-text"><h4>NSS (Seguro Social)</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('nss', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('nss', false)">‚ùå No</button></div></div>
                    <div class="checklist-item" id="item-infonavit"><div class="checklist-item-left"><div class="checklist-item-icon">üè°</div><div class="checklist-item-text"><h4>Infonavit</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('infonavit', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('infonavit', false)">‚ùå No</button><button class="toggle-btn" onclick="setDocStatus('infonavit', 'na')">‚ûñ N/A</button></div></div>
                    <div class="checklist-item" id="item-fonacot"><div class="checklist-item-left"><div class="checklist-item-icon">üí∞</div><div class="checklist-item-text"><h4>Fonacot</h4></div></div><div class="checklist-toggle"><button class="toggle-btn" onclick="setDocStatus('fonacot', true)">‚úÖ S√≠</button><button class="toggle-btn" onclick="setDocStatus('fonacot', false)">‚ùå No</button><button class="toggle-btn" onclick="setDocStatus('fonacot', 'na')">‚ûñ N/A</button></div></div>
                </div>

                <div class="checklist-section">
                    <div class="checklist-section-title">üö® Contacto de Emergencia</div>
                    <div class="contact-form">
                        <div class="form-row">
                            <div class="form-group"><label>Nombre completo *</label><input type="text" id="emergencia-nombre" placeholder="Nombre del contacto" required></div>
                            <div class="form-group"><label>Parentesco *</label><select id="emergencia-parentesco" required><option value="">Seleccionar...</option><option value="Padre">Padre</option><option value="Madre">Madre</option><option value="Esposo(a)">Esposo(a)</option><option value="Hermano(a)">Hermano(a)</option><option value="Hijo(a)">Hijo(a)</option><option value="Otro">Otro</option></select></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Tel√©fono *</label><input type="tel" id="emergencia-telefono" placeholder="10 d√≠gitos" maxlength="10" pattern="[0-9]{10}" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required></div>
                            <div class="form-group"><label>Fecha de nacimiento *</label><input type="date" id="emergencia-fecha-nac" max="2008-01-01" required></div>
                        </div>
                    </div>
                </div>

                <div class="checklist-section">
                    <div class="checklist-section-title">üìù Observaciones</div>
                    <textarea class="obs-textarea" id="observaciones" placeholder="Notas adicionales..."></textarea>
                </div>

                <div class="btn-row">
                    <button class="btn btn-secondary" onclick="volverALista()">‚Üê Volver</button>
                    <button class="btn btn-primary" id="btn-guardar" onclick="guardarChecklist()">üíæ Guardar</button>
                </div>
            </div>
        </div>

        <div class="section" id="section-confirmacion">
            <div class="card"><div class="confirmation-screen" id="confirmacion-content"></div></div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-recordatorio">
        <div class="modal">
            <h3>üì© Enviar Recordatorio</h3>
            <p id="modal-mensaje">¬øDeseas enviar un recordatorio de documentos pendientes?</p>
            <div class="btn-row">
                <button class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="confirmarRecordatorio()">üì© Enviar</button>
            </div>
        </div>
    </div>

    <script>
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby-HOsviZvkv83Lrsu6cFukqRK6uuft9nw438lxPv2WOX_prRx3CfosVF7-BxuwBJCQ9A/exec';
let selectedReclutador = '', selectedSucursal = '', selectedFecha = '', selectedAspirante = null, aspirantesList = [], recordatorioData = null;
let checklistStatus = { ine: null, curp: null, domicilio: null, acta: null, rfc: null, banco: null, psico: null, csf: null, estudios: null, laboral: null, nss: null, infonavit: null, fonacot: null };

function showSection(id) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
function showTab(tab) { document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active'); document.getElementById('tab-' + tab).classList.add('active'); }

async function onSucursalChange() {
    selectedSucursal = document.getElementById('select-sucursal').value;
    const selectFecha = document.getElementById('select-fecha');
    const reclutadorGroup = document.getElementById('reclutador-group');
    const selectReclutador = document.getElementById('select-reclutador');
    
    // Resetear fecha y ocultar listas
    selectedFecha = '';
    selectFecha.value = '';
    document.getElementById('aspirantes-card').style.display = 'none';
    document.getElementById('stats-bar').style.display = 'none';
    document.getElementById('btn-actualizar').style.display = 'none';
    
    if (!selectedSucursal) { 
        selectFecha.disabled = true; 
        selectFecha.innerHTML = '<option value="">Primero selecciona sucursal...</option>'; 
        reclutadorGroup.style.display = 'none';
        selectedReclutador = '';
        return; 
    }
    
    // Configurar reclutador seg√∫n sucursal
    if (selectedSucursal === 'Torre JV Ju√°rez') {
        // JV solo tiene a Karla, se asigna autom√°ticamente
        reclutadorGroup.style.display = 'none';
        selectedReclutador = 'Karla Flores';
    } else if (selectedSucursal === 'Edificio Inbursa Antequera') {
        // Antequera tiene dos reclutadores, mostrar selector
        reclutadorGroup.style.display = 'block';
        selectReclutador.innerHTML = '<option value="">Todos los reclutadores...</option><option value="Yessica Huerta">Yessica Huerta</option><option value="Jezabel">Jezabel Monterrosas</option>';
        selectedReclutador = ''; // Vac√≠o = mostrar todos
    }
    
    // Cargar fechas
    selectFecha.disabled = false; 
    selectFecha.innerHTML = '<option value="">Cargando fechas...</option>';
    
    try {
        const r = await fetch(GOOGLE_SCRIPT_URL + '?action=getFechasPanel&sucursal=' + encodeURIComponent(selectedSucursal));
        const data = await r.json();
        if (data.fechas && data.fechas.length > 0) { 
            selectFecha.innerHTML = '<option value="">Selecciona fecha...</option>'; 
            data.fechas.forEach(f => { 
                const opt = document.createElement('option'); 
                opt.value = f.fecha || f.valor; 
                opt.textContent = f.fechaLegible || f.texto; 
                selectFecha.appendChild(opt); 
            }); 
        } else { 
            selectFecha.innerHTML = '<option value="">No hay fechas disponibles</option>'; 
        }
    } catch (e) { 
        console.error(e); 
        selectFecha.innerHTML = '<option value="">Error al cargar</option>'; 
    }
}

async function onFechaChange() { 
    selectedFecha = document.getElementById('select-fecha').value; 
    if (selectedFecha) { 
        cargarAspirantesAprobados(); 
        document.getElementById('btn-actualizar').style.display = 'block';
    } else {
        document.getElementById('aspirantes-card').style.display = 'none';
        document.getElementById('stats-bar').style.display = 'none';
        document.getElementById('btn-actualizar').style.display = 'none';
    }
}

function onReclutadorChange() {
    selectedReclutador = document.getElementById('select-reclutador').value;
    // Solo recargar si ya hay una fecha seleccionada
    if (selectedFecha) {
        cargarAspirantesAprobados();
    }
}

function actualizarLista() {
    if (selectedFecha) {
        cargarAspirantesAprobados();
    }
}

async function cargarAspirantesAprobados() {
    document.getElementById('aspirantes-card').style.display = 'block'; 
    document.getElementById('stats-bar').style.display = 'flex';
    document.getElementById('lista-pendientes').innerHTML = '<p style="text-align:center;padding:20px;"><span class="loading loading-dark"></span></p>'; 
    document.getElementById('lista-completos').innerHTML = '';
    
    try {
        const r = await fetch(GOOGLE_SCRIPT_URL + '?action=getAprobadosParaChecklist&fecha=' + encodeURIComponent(selectedFecha) + '&sucursal=' + encodeURIComponent(selectedSucursal));
        const data = await r.json(); 
        let aprobados = data.aprobados || [];
        
        // Solo filtrar por reclutador en Antequera cuando se selecciona uno espec√≠fico
        if (selectedSucursal === 'Edificio Inbursa Antequera' && selectedReclutador) {
            console.log('Filtrando por reclutador:', selectedReclutador);
            console.log('Aspirantes antes del filtro:', JSON.stringify(aprobados.map(a => ({ nombre: a.nombre, reclutador: a.reclutador }))));
            aprobados = aprobados.filter(a => {
                if (!a.reclutador) return false;
                const reclutadorLower = a.reclutador.toLowerCase();
                const filtroLower = selectedReclutador.toLowerCase();
                return reclutadorLower.includes(filtroLower) || filtroLower.includes(reclutadorLower);
            });
            console.log('Aspirantes despu√©s del filtro:', aprobados.length);
        }
        
        aspirantesList = aprobados;
        const completos = aspirantesList.filter(a => a.estadoChecklist === 'Completo');
        const pendientes = aspirantesList.filter(a => a.estadoChecklist === 'Pendiente');
        const sinIniciar = aspirantesList.filter(a => a.estadoChecklist === 'Sin iniciar');
        
        document.getElementById('stat-completos').textContent = completos.length;
        document.getElementById('stat-pendientes').textContent = pendientes.length;
        document.getElementById('stat-sin-iniciar').textContent = sinIniciar.length;
        document.getElementById('tab-pendientes-count').textContent = pendientes.length + sinIniciar.length;
        document.getElementById('tab-completos-count').textContent = completos.length;
        
        renderizarLista('lista-pendientes', [...pendientes, ...sinIniciar]);
        renderizarLista('lista-completos', completos);
    } catch (e) { 
        console.error(e); 
        document.getElementById('lista-pendientes').innerHTML = '<p style="text-align:center;color:var(--danger);">Error al cargar</p>'; 
    }
}

function renderizarLista(containerId, lista) {
    const container = document.getElementById(containerId);
    if (lista.length === 0) { 
        container.innerHTML = `<div class="empty-state"><div class="icon">${containerId === 'lista-completos' ? 'üì≠' : 'üéâ'}</div><h3>${containerId === 'lista-completos' ? 'Sin completos a√∫n' : '¬°Todos listos!'}</h3><p>${containerId === 'lista-completos' ? 'Los aspirantes completados aparecer√°n aqu√≠' : 'No hay aspirantes pendientes'}</p></div>`; 
        return; 
    }
    container.innerHTML = '';
    lista.forEach(asp => {
        const iniciales = asp.nombre.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
        const statusClass = asp.estadoChecklist === 'Completo' ? 'status-completo' : asp.estadoChecklist === 'Pendiente' ? 'status-pendiente' : 'status-nuevo';
        const statusText = asp.estadoChecklist === 'Completo' ? 'Completo' : asp.estadoChecklist === 'Pendiente' ? 'Pendiente' : 'Sin iniciar';
        const badgeClass = asp.estadoChecklist === 'Completo' ? 'completo' : asp.estadoChecklist === 'Pendiente' ? 'pendiente' : 'nuevo';
        const div = document.createElement('div'); 
        div.className = 'aspirante-card ' + statusClass;
        div.innerHTML = `<div class="aspirante-avatar">${iniciales}</div><div class="aspirante-info"><h4>${asp.nombre}</h4><p>${asp.puntaje}/80 pts ‚Ä¢ ${asp.resultado}</p>${asp.docsPendientes ? `<div class="docs-pendientes">üìã Falta: ${asp.docsPendientes}</div>` : ''}</div><div class="aspirante-status"><span class="status-badge ${badgeClass}">${statusText}</span>${asp.estadoChecklist === 'Pendiente' && asp.docsPendientes ? `<button class="btn-recordatorio" onclick="event.stopPropagation(); abrirModalRecordatorio('${asp.nombre}', '${asp.telefono}', '${asp.email || ''}', '${asp.docsPendientes}')">üì© Recordatorio</button>` : ''}</div>`;
        div.onclick = () => seleccionarAspirante(asp); 
        container.appendChild(div);
    });
}

function abrirModalRecordatorio(nombre, telefono, email, docsPendientes) { 
    recordatorioData = { nombre, telefono, email, docsPendientes: docsPendientes.split(', '), sucursal: selectedSucursal }; 
    document.getElementById('modal-mensaje').innerHTML = `¬øEnviar recordatorio a <strong>${nombre}</strong> sobre los documentos pendientes?<br><br><small>üìã ${docsPendientes}</small>`; 
    document.getElementById('modal-recordatorio').classList.add('active'); 
}

function cerrarModal() { 
    document.getElementById('modal-recordatorio').classList.remove('active'); 
    recordatorioData = null; 
}

async function confirmarRecordatorio() {
    if (!recordatorioData) return;
    const btn = document.querySelector('#modal-recordatorio .btn-primary'); 
    btn.disabled = true; 
    btn.innerHTML = '<span class="loading"></span>';
    
    // Guardar datos antes de cerrar modal
    const datos = { ...recordatorioData };
    const tieneEmail = datos.email && datos.email.trim() !== '';
    
    // Generar mensaje de WhatsApp
    const primerNombre = datos.nombre.split(' ')[0];
    const docsLista = datos.docsPendientes.map(d => 'üìÑ ' + d).join('\n');
    const mensaje = `¬°Hola ${primerNombre}! üëã\n\nTe recordamos que para continuar con tu proceso de ingreso a *ExpertCell* necesitamos los siguientes documentos:\n\n${docsLista}\n\nPor favor tr√°elos a la brevedad a nuestra sucursal *${datos.sucursal}*.\n\n¬°Gracias! üôå`;
    
    // Formatear tel√©fono (agregar 52 si no lo tiene)
    let telefono = (datos.telefono || '').replace(/\D/g, '');
    if (telefono.length === 10) telefono = '52' + telefono;
    
    const urlWhatsApp = `https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`;
    
    // Intentar enviar email tambi√©n (solo si hay email)
    if (tieneEmail) {
        try {
            const params = new URLSearchParams({ action: 'enviarRecordatorio', nombre: datos.nombre, telefono: datos.telefono, email: datos.email, docsPendientes: datos.docsPendientes.join(','), sucursal: datos.sucursal });
            await fetch(GOOGLE_SCRIPT_URL + '?' + params.toString());
        } catch (e) { console.log('Email no enviado:', e); }
    }
    
    // Cerrar modal y abrir WhatsApp
    cerrarModal();
    btn.disabled = false; 
    btn.innerHTML = 'üì© Enviar';
    
    // Abrir WhatsApp
    window.open(urlWhatsApp, '_blank');
    alert(tieneEmail ? '‚úÖ Recordatorio enviado por email y WhatsApp abierto' : '‚úÖ WhatsApp abierto (sin email registrado)');
}

function seleccionarAspirante(asp) {
    selectedAspirante = asp;
    const iniciales = asp.nombre.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
    document.getElementById('aspirante-iniciales').textContent = iniciales;
    document.getElementById('aspirante-nombre').textContent = asp.nombre;
    document.getElementById('aspirante-detalles').textContent = `${asp.puntaje}/80 pts ‚Ä¢ ${asp.resultado}`;
    
    // LIMPIAR completamente el checklistStatus
    checklistStatus = { ine: null, curp: null, domicilio: null, acta: null, rfc: null, banco: null, psico: null, csf: null, estudios: null, laboral: null, nss: null, infonavit: null, fonacot: null };
    
    // LIMPIAR todos los items visualmente primero
    const allDocs = ['ine', 'curp', 'domicilio', 'acta', 'rfc', 'banco', 'psico', 'csf', 'estudios', 'laboral', 'nss', 'infonavit', 'fonacot'];
    allDocs.forEach(doc => {
        const item = document.getElementById('item-' + doc);
        if (item) {
            item.classList.remove('checked', 'pending');
            item.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active-yes', 'active-no', 'active-na'));
        }
    });
    
    // Cargar datos existentes si hay
    if (asp.docs) { 
        Object.keys(asp.docs).forEach(key => { 
            if (asp.docs[key] !== null && asp.docs[key] !== 'na') { 
                checklistStatus[key] = asp.docs[key]; 
                updateItemUI(key, asp.docs[key]); 
            } else if (asp.docs[key] === 'na') {
                checklistStatus[key] = 'na';
                updateItemUI(key, 'na');
            }
        }); 
    }
    
    // Limpiar campos de emergencia primero
    document.getElementById('emergencia-nombre').value = '';
    document.getElementById('emergencia-parentesco').value = '';
    document.getElementById('emergencia-telefono').value = '';
    document.getElementById('emergencia-fecha-nac').value = '';
    
    // Cargar contacto de emergencia si existe
    if (asp.emergencia) { 
        document.getElementById('emergencia-nombre').value = asp.emergencia.nombre || ''; 
        document.getElementById('emergencia-parentesco').value = asp.emergencia.parentesco || ''; 
        document.getElementById('emergencia-telefono').value = asp.emergencia.telefono || ''; 
        document.getElementById('emergencia-fecha-nac').value = asp.emergencia.fechaNac || ''; 
    }
    
    // Limpiar y cargar observaciones
    document.getElementById('observaciones').value = asp.observaciones || '';
    
    // Rehabilitar bot√≥n guardar
    const btn = document.getElementById('btn-guardar');
    btn.disabled = false;
    btn.innerHTML = 'üíæ Guardar';
    
    showSection('section-checklist');
}

function setDocStatus(doc, status) { 
    checklistStatus[doc] = status; 
    updateItemUI(doc, status); 
}

function updateItemUI(doc, status) {
    const item = document.getElementById('item-' + doc); 
    if (!item) return;
    item.classList.remove('checked', 'pending');
    if (status === true) { 
        item.classList.add('checked'); 
    } else if (status === false) { 
        item.classList.add('pending'); 
    }
    const buttons = item.querySelectorAll('.toggle-btn');
    buttons.forEach(btn => { 
        btn.classList.remove('active-yes', 'active-no', 'active-na'); 
        if (status === true && btn.textContent.includes('S√≠')) { 
            btn.classList.add('active-yes'); 
        } else if (status === false && btn.textContent.includes('No')) { 
            btn.classList.add('active-no'); 
        } else if (status === 'na' && btn.textContent.includes('N/A')) { 
            btn.classList.add('active-na'); 
        } 
    });
}

function volverALista() { 
    showSection('section-seleccion'); 
    cargarAspirantesAprobados(); 
}

async function guardarChecklist() {
    // Validaciones de contacto de emergencia
    const emergNombre = document.getElementById('emergencia-nombre').value.trim();
    const emergParentesco = document.getElementById('emergencia-parentesco').value;
    const emergTelefono = document.getElementById('emergencia-telefono').value.trim();
    const emergFechaNac = document.getElementById('emergencia-fecha-nac').value;
    
    if (!emergNombre) {
        alert('‚ö†Ô∏è El nombre del contacto de emergencia es obligatorio');
        document.getElementById('emergencia-nombre').focus();
        return;
    }
    
    if (!emergParentesco) {
        alert('‚ö†Ô∏è El parentesco del contacto de emergencia es obligatorio');
        document.getElementById('emergencia-parentesco').focus();
        return;
    }
    
    if (!emergTelefono) {
        alert('‚ö†Ô∏è El tel√©fono del contacto de emergencia es obligatorio');
        document.getElementById('emergencia-telefono').focus();
        return;
    }
    
    if (emergTelefono.replace(/\D/g, '').length !== 10) {
        alert('‚ö†Ô∏è El tel√©fono de emergencia debe tener exactamente 10 d√≠gitos');
        document.getElementById('emergencia-telefono').focus();
        return;
    }
    
    if (!emergFechaNac) {
        alert('‚ö†Ô∏è La fecha de nacimiento del contacto de emergencia es obligatoria');
        document.getElementById('emergencia-fecha-nac').focus();
        return;
    }
    
    const fechaNac = new Date(emergFechaNac);
    const hoy = new Date();
    const edad = Math.floor((hoy - fechaNac) / (365.25 * 24 * 60 * 60 * 1000));
    if (edad < 18) {
        alert('‚ö†Ô∏è El contacto de emergencia debe ser mayor de 18 a√±os');
        document.getElementById('emergencia-fecha-nac').focus();
        return;
    }
    
    // Validar reclutador - usar el del aspirante si no se seleccion√≥ uno espec√≠fico
    let reclutadorFinal = selectedReclutador;
    if (selectedSucursal === 'Edificio Inbursa Antequera') {
        const selectReclutadorEl = document.getElementById('select-reclutador');
        const reclutadorSelect = selectReclutadorEl ? selectReclutadorEl.value : '';
        if (reclutadorSelect) {
            reclutadorFinal = reclutadorSelect;
        } else if (selectedAspirante && selectedAspirante.reclutador) {
            // Usar el reclutador que ya tiene el aspirante desde Entrevistas Telef√≥nicas
            reclutadorFinal = selectedAspirante.reclutador;
        } else {
            alert('‚ö†Ô∏è Debes seleccionar un reclutador');
            return;
        }
    }
    // Para JV ya est√° asignado autom√°ticamente como 'Karla Flores'
    
    const btn = document.getElementById('btn-guardar'); 
    btn.disabled = true; 
    btn.innerHTML = '<span class="loading"></span> Guardando...';
    
    const data = { 
        tipo: 'checklist_panel', 
        reclutador: reclutadorFinal, 
        sucursal: selectedSucursal, 
        fecha: selectedFecha, 
        aspirante_nombre: selectedAspirante.nombre, 
        aspirante_telefono: selectedAspirante.telefono, 
        aspirante_email: selectedAspirante.email || '', 
        ine: checklistStatus.ine, 
        domicilio: checklistStatus.domicilio, 
        curp: checklistStatus.curp, 
        rfc: checklistStatus.rfc, 
        csf: checklistStatus.csf, 
        acta: checklistStatus.acta, 
        estudios: checklistStatus.estudios, 
        laboral: checklistStatus.laboral, 
        banco: checklistStatus.banco, 
        nss: checklistStatus.nss, 
        infonavit: checklistStatus.infonavit, 
        fonacot: checklistStatus.fonacot, 
        psico: checklistStatus.psico, 
        emergencia_nombre: document.getElementById('emergencia-nombre').value, 
        emergencia_parentesco: document.getElementById('emergencia-parentesco').value, 
        emergencia_telefono: document.getElementById('emergencia-telefono').value, 
        emergencia_fecha_nac: document.getElementById('emergencia-fecha-nac').value, 
        observaciones: document.getElementById('observaciones').value, 
        timestamp: new Date().toLocaleString('es-MX'), 
        enviarFelicitacion: true 
    };
    
    console.log('Datos a enviar:', JSON.stringify(data, null, 2));
    console.log('checklistStatus:', checklistStatus);
    
    try { 
        const r = await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) }); 
        const result = await r.json(); 
        console.log('Respuesta del servidor:', result);
        mostrarConfirmacion(result); 
    }
    catch (e) { 
        console.error('Error:', e); 
        alert('Error al guardar: ' + e.message); 
    }
    finally { 
        btn.disabled = false; 
        btn.innerHTML = 'üíæ Guardar'; 
    }
}

function mostrarConfirmacion(result) {
    const container = document.getElementById('confirmacion-content');
    if (result.estadoChecklist === 'Completo') {
        container.innerHTML = `<div class="confirmation-icon success">‚úÖ</div><h2>¬°Checklist Completo!</h2><p><strong>${selectedAspirante.nombre}</strong></p><p>Todos los documentos obligatorios fueron registrados.</p>${result.felicitacionEnviada ? '<p style="color: var(--success); font-weight: 600;">‚úâÔ∏è Email de felicitaci√≥n enviado</p>' : '<p style="color: var(--warning);">‚ö†Ô∏è No se envi√≥ email (ya fue enviado anteriormente o sin correo)</p>'}<div class="btn-row" style="margin-top: 30px;"><button class="btn btn-primary" onclick="volverALista()">‚Üê Volver a la lista</button></div>`;
    } else {
        const docsList = result.docsPendientes && result.docsPendientes.length > 0 ? result.docsPendientes.map(d => `<li>${d}</li>`).join('') : '<li>Ninguno especificado</li>';
        container.innerHTML = `<div class="confirmation-icon pending">‚è≥</div><h2>Checklist Guardado</h2><p><strong>${selectedAspirante.nombre}</strong></p><p>El checklist qued√≥ en estado <strong>Pendiente</strong></p><div class="docs-list"><h4>üìã Documentos faltantes:</h4><ul>${docsList}</ul></div><p style="font-size: 13px; color: var(--gray-500);">El email de felicitaci√≥n se enviar√° cuando todos los documentos obligatorios est√©n completos.</p><div class="btn-row" style="margin-top: 30px;"><button class="btn btn-primary" onclick="volverALista()">‚Üê Volver a la lista</button></div>`;
    }
    showSection('section-confirmacion');
}
    </script>
</body>
</html>
