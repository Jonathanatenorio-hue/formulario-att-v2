<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrevista Panel | AT&T - ExpertCell</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --att-blue: #00A8E1;
            --att-blue-dark: #0057B8;
            --att-blue-deeper: #003A70;
            --white: #FFFFFF;
            --gray-50: #F8FAFC;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-300: #CBD5E1;
            --gray-400: #94A3B8;
            --gray-500: #64748B;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1E293B;
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --danger: #EF4444;
            --danger-light: #FEE2E2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'IBM Plex Sans', sans-serif; background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%); min-height: 100vh; color: var(--gray-800); }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .header { background: url('https://jonathanatenorio-hue.github.io/formulario-att-v2/logo-att.png') center center / cover no-repeat; padding: 30px; border-radius: 16px; margin-bottom: 24px; box-shadow: 0 10px 40px rgba(0, 87, 184, 0.3); position: relative; overflow: hidden; min-height: 160px; }
        .header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to right, rgba(0, 58, 112, 0.9) 0%, rgba(0, 58, 112, 0.3) 50%, transparent 100%); }
        .header-content { display: flex; flex-direction: column; justify-content: center; align-items: flex-start; position: relative; z-index: 1; min-height: 100px; }
        .header-text h1 { color: var(--white); font-size: 28px; font-weight: 700; margin-bottom: 4px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header-text p { color: rgba(255,255,255,0.95); font-size: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .card { background: var(--white); border-radius: 16px; padding: 28px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); border: 1px solid var(--gray-200); }
        .card-title { font-size: 18px; font-weight: 600; color: var(--gray-800); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .card-title .icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 18px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 14px; font-weight: 500; color: var(--gray-700); margin-bottom: 8px; }
        .form-group select, .form-group input, .form-group textarea { width: 100%; padding: 14px 16px; border: 2px solid var(--gray-200); border-radius: 10px; font-size: 15px; font-family: inherit; transition: all 0.2s ease; background: var(--white); }
        .form-group select:focus, .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--att-blue); box-shadow: 0 0 0 4px rgba(0, 168, 225, 0.1); }
        .btn { padding: 14px 28px; border-radius: 10px; font-size: 15px; font-weight: 600; font-family: inherit; cursor: pointer; transition: all 0.2s ease; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); color: var(--white); box-shadow: 0 4px 15px rgba(0, 168, 225, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 168, 225, 0.4); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--gray-100); color: var(--gray-700); border: 2px solid var(--gray-200); }
        .btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%); color: var(--white); }
        .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-modal { background: var(--white); border-radius: 20px; padding: 40px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .login-modal h2 { font-size: 24px; margin-bottom: 8px; color: var(--gray-800); }
        .login-modal p { color: var(--gray-500); margin-bottom: 24px; font-size: 14px; }
        .login-modal .form-group { text-align: left; }
        .login-error { color: var(--danger); font-size: 13px; margin-top: 10px; display: none; }
        .login-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; }
        .evaluadores-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; }
        .evaluador-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--gray-50); border: 2px solid var(--gray-200); border-radius: 10px; cursor: pointer; transition: all 0.2s ease; }
        .evaluador-item:hover { border-color: var(--att-blue); background: rgba(0, 168, 225, 0.05); }
        .evaluador-item.selected { border-color: var(--att-blue); background: rgba(0, 168, 225, 0.1); }
        .evaluador-check { width: 24px; height: 24px; border: 2px solid var(--gray-300); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: transparent; }
        .evaluador-item.selected .evaluador-check { background: var(--att-blue); border-color: var(--att-blue); color: var(--white); }
        .evaluador-name { font-size: 14px; font-weight: 500; color: var(--gray-700); }
        .aspirantes-list { display: flex; flex-direction: column; gap: 12px; }
        .aspirante-card { display: flex; align-items: center; justify-content: space-between; padding: 18px 20px; background: var(--gray-50); border: 2px solid var(--gray-200); border-radius: 12px; cursor: pointer; transition: all 0.2s ease; }
        .aspirante-card:hover:not(.no-show):not(.cerrado) { border-color: var(--att-blue); background: var(--white); box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
        .aspirante-card.evaluated { border-color: var(--success); background: var(--success-light); }
        .aspirante-card.no-show { border-color: var(--danger); background: var(--danger-light); opacity: 0.7; cursor: not-allowed; }
        .aspirante-card.cerrado { border-color: var(--gray-400); background: var(--gray-100); opacity: 0.6; cursor: not-allowed; }
        .aspirante-info { display: flex; align-items: center; gap: 15px; }
        .aspirante-avatar { width: 48px; height: 48px; background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--white); font-weight: 600; font-size: 18px; }
        .aspirante-card.no-show .aspirante-avatar, .aspirante-card.cerrado .aspirante-avatar { background: linear-gradient(135deg, var(--gray-400) 0%, var(--gray-500) 100%); }
        .aspirante-details h4 { font-size: 16px; font-weight: 600; color: var(--gray-800); margin-bottom: 4px; }
        .aspirante-details p { font-size: 13px; color: var(--gray-500); }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-pending { background: var(--warning-light); color: var(--warning); }
        .status-evaluated { background: var(--success-light); color: var(--success); }
        .status-noshow { background: var(--danger-light); color: var(--danger); }
        .status-cerrado { background: var(--gray-200); color: var(--gray-600); }
        .section { display: none; }
        .section.active { display: block; }
        .eval-section { background: var(--gray-50); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .eval-section-title { font-size: 16px; font-weight: 600; color: var(--att-blue-dark); margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid var(--gray-200); }
        .eval-question { margin-bottom: 24px; }
        .eval-question:last-child { margin-bottom: 0; }
        .eval-question-text { font-size: 14px; font-weight: 500; color: var(--gray-700); margin-bottom: 8px; line-height: 1.5; }
        .eval-question-hint { font-size: 12px; color: var(--gray-500); margin-bottom: 8px; font-style: italic; }
        .eval-guide { font-size: 11px; color: var(--gray-600); margin-bottom: 12px; padding: 10px; background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%); border-radius: 8px; border-left: 3px solid var(--att-blue); }
        .eval-guide strong { color: var(--att-blue-dark); }
        .rating-scale { display: flex; gap: 8px; }
        .rating-btn { width: 48px; height: 48px; border: 2px solid var(--gray-200); border-radius: 10px; background: var(--white); font-size: 16px; font-weight: 600; color: var(--gray-500); cursor: pointer; transition: all 0.2s ease; }
        .rating-btn:hover { border-color: var(--att-blue); color: var(--att-blue); }
        .rating-btn.selected { background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-color: var(--att-blue); color: var(--white); }
        .option-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .option-btn { padding: 12px 20px; border: 2px solid var(--gray-200); border-radius: 10px; background: var(--white); font-size: 14px; font-weight: 500; color: var(--gray-600); cursor: pointer; transition: all 0.2s ease; }
        .option-btn:hover { border-color: var(--att-blue); }
        .option-btn.selected { background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-color: var(--att-blue); color: var(--white); }
        .option-btn.selected-warning { background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%); border-color: var(--warning); color: var(--white); }
        .option-btn.selected-danger { background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%); border-color: var(--danger); color: var(--white); }
        .eval-progress { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; }
        .progress-bar { flex: 1; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); transition: width 0.3s ease; }
        .progress-text { font-size: 14px; font-weight: 600; color: var(--gray-600); min-width: 60px; text-align: right; }
        .resultado-preview { background: linear-gradient(135deg, var(--gray-800) 0%, var(--gray-700) 100%); border-radius: 12px; padding: 24px; color: var(--white); text-align: center; margin-top: 20px; }
        .resultado-preview h3 { font-size: 14px; font-weight: 500; opacity: 0.8; margin-bottom: 8px; }
        .resultado-score { font-size: 48px; font-weight: 700; margin-bottom: 8px; }
        .resultado-label { font-size: 18px; font-weight: 600; padding: 8px 20px; border-radius: 20px; display: inline-block; }
        .eval-aspirante-header { display: flex; align-items: center; justify-content: space-between; padding: 20px; background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-radius: 12px; margin-bottom: 24px; color: var(--white); flex-wrap: wrap; gap: 15px; }
        .eval-aspirante-info { display: flex; align-items: center; gap: 16px; }
        .eval-aspirante-avatar { width: 56px; height: 56px; background: rgba(255,255,255,0.2); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 700; }
        .eval-aspirante-details h3 { font-size: 20px; font-weight: 600; margin-bottom: 4px; }
        .eval-aspirante-details p { opacity: 0.8; font-size: 14px; }
        .nav-buttons { display: flex; gap: 12px; margin-top: 24px; }
        .nav-buttons .btn { flex: 1; }
        .confirmation-screen { text-align: center; padding: 60px 20px; }
        .confirmation-icon { width: 100px; height: 100px; background: linear-gradient(135deg, var(--success) 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 48px; color: var(--white); }
        .confirmation-screen h2 { font-size: 24px; color: var(--gray-800); margin-bottom: 12px; }
        .confirmation-screen p { color: var(--gray-500); margin-bottom: 24px; }
        .no-show-container { text-align: center; padding: 40px 20px; }
        .no-show-icon { font-size: 64px; margin-bottom: 20px; }
        .no-show-container h3 { font-size: 20px; color: var(--gray-700); margin-bottom: 10px; }
        .no-show-container p { color: var(--gray-500); margin-bottom: 24px; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: var(--white); animation: spin 0.8s linear infinite; }
        .loading-dark { border: 2px solid var(--gray-200); border-top-color: var(--att-blue); }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .guide-box { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid var(--warning); border-radius: 12px; padding: 16px; margin-bottom: 20px; }
        .guide-box-title { font-size: 14px; font-weight: 600; color: #92400e; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .guide-box-content { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .guide-item { text-align: center; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px; }
        .guide-item-score { font-size: 18px; font-weight: 700; }
        .guide-item-label { font-size: 11px; color: var(--gray-600); }
        .guide-item.green .guide-item-score { color: var(--success); }
        .guide-item.yellow .guide-item-score { color: var(--warning); }
        .guide-item.red .guide-item-score { color: var(--danger); }
        .user-badge { position: fixed; top: 20px; right: 20px; background: var(--white); padding: 10px 16px; border-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; z-index: 100; }
        .user-badge-avatar { width: 32px; height: 32px; background: linear-gradient(135deg, var(--att-blue) 0%, var(--att-blue-dark) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600; }
        .user-badge-name { font-size: 14px; font-weight: 600; color: var(--gray-700); }
        .user-badge-logout { background: none; border: none; color: var(--gray-400); cursor: pointer; font-size: 16px; padding: 4px; }
        .user-badge-logout:hover { color: var(--danger); }

        /* === Preguntas obligatorias del panelista === */
        .panelist-questions { background: var(--gray-50); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .panelist-header { background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%); color: white; padding: 16px 20px; border-radius: 10px; margin-bottom: 20px; }
        .panelist-header h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .panelist-header p { font-size: 12px; opacity: 0.9; }
        .panelist-q { margin-bottom: 20px; }
        .panelist-q:last-child { margin-bottom: 0; }
        .panelist-q-label { font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px; display: flex; align-items: flex-start; gap: 6px; line-height: 1.5; }
        .panelist-q-label .req { color: var(--danger); font-weight: 700; font-size: 16px; }
        .panelist-textarea { width: 100%; padding: 14px; border: 2px solid var(--gray-200); border-radius: 10px; font-family: inherit; font-size: 14px; min-height: 80px; resize: vertical; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .panelist-textarea:focus { outline: none; border-color: #7C3AED; box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1); }
        .panelist-textarea.field-error { border-color: var(--danger); background: #FFF5F5; }
        .panelist-textarea.field-error:focus { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1); }
        .panelist-textarea.field-valid { border-color: var(--success); }
        .field-hint { font-size: 12px; margin-top: 5px; color: var(--gray-400); }
        .field-hint.hint-error { color: var(--danger); font-weight: 500; }
        .field-hint.hint-ok { color: var(--success); font-weight: 500; }
        .conditional-q { display: none; }
        .conditional-q.visible { display: block; }
        .conditional-q-approved { border-left: 4px solid var(--success); padding-left: 16px; }
        .conditional-q-failed { border-left: 4px solid var(--danger); padding-left: 16px; }
        .missing-fields-alert { background: linear-gradient(135deg, var(--danger-light) 0%, #fecaca 100%); border: 2px solid var(--danger); border-radius: 10px; padding: 14px 18px; margin-top: 16px; display: none; align-items: center; gap: 10px; font-size: 13px; color: #991b1b; font-weight: 500; }
        .missing-fields-alert.visible { display: flex; }

        /* Historial completo del aspirante */
        .hist-section { margin-bottom: 16px; }
        .hist-section-title { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; padding: 8px 12px; border-radius: 8px; margin-bottom: 10px; }
        .hist-datos { background: #E0F2FE; color: #0369A1; }
        .hist-prefiltro { background: #FEF3C7; color: #92400E; }
        .hist-telefonica { background: #EDE9FE; color: #5B21B6; }
        .hist-item { background: white; padding: 10px 12px; border-radius: 8px; margin-bottom: 8px; font-size: 13px; }
        .hist-item-label { font-size: 11px; font-weight: 600; color: var(--gray-500); text-transform: uppercase; letter-spacing: 0.3px; }
        .hist-item-value { color: var(--gray-800); margin-top: 2px; }

        @media (max-width: 640px) {
            .container { padding: 12px; }
            .header { padding: 20px; }
            .header-content { flex-direction: column; text-align: center; }
            .header-text h1 { font-size: 22px; }
            .card { padding: 20px; }
            .evaluadores-grid { grid-template-columns: 1fr; }
            .rating-scale { justify-content: space-between; }
            .rating-btn { width: 42px; height: 42px; font-size: 14px; }
            .option-buttons { flex-direction: column; }
            .option-btn { width: 100%; text-align: center; }
            .eval-aspirante-header { flex-direction: column; text-align: center; }
            .guide-box-content { grid-template-columns: 1fr; }
            .user-badge { top: auto; bottom: 20px; right: 20px; }
        }
    </style>
</head>
<body>

    <div class="user-badge" id="user-badge" style="display: none;">
        <div class="user-badge-avatar" id="badge-avatar">XX</div>
        <span class="user-badge-name" id="badge-name">Usuario</span>
        <button class="user-badge-logout" onclick="cerrarSesion()" title="Cerrar sesi√≥n">‚úï</button>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-text">
                    <h1>Entrevista Panel</h1>
                    <p>Sistema de Evaluaci√≥n | ExpertCell</p>
                </div>
            </div>
        </div>

        <!-- Secci√≥n Config -->
        <div class="section active" id="section-config">
            <div class="card fade-in">
                <div class="card-title"><span class="icon">üìç</span>Configuraci√≥n de Sesi√≥n</div>
                <div class="form-group">
                    <label>Sucursal</label>
                    <select id="select-sucursal" onchange="onSucursalChange()">
                        <option value="">Selecciona una sucursal</option>
                        <option value="Torre JV Ju√°rez">Torre JV Ju√°rez</option>
                        <option value="Edificio Inbursa Antequera">Edificio Inbursa Antequera</option>
                    </select>
                </div>
                <div class="form-group" id="grupo-container" style="display: none;">
                    <label>Grupo (Fecha de Panel)</label>
                    <select id="select-grupo" onchange="onGrupoChange()">
                        <option value="">Selecciona un grupo</option>
                    </select>
                </div>
                <div class="form-group" id="evaluador-container" style="display: none;">
                    <label>¬øQui√©n eval√∫a?</label>
                    <select id="select-evaluador" onchange="onEvaluadorChange()">
                        <option value="">Selecciona tu nombre</option>
                        <option value="Pilar Garc√≠a">Pilar Garc√≠a</option>
                        <option value="Julio Castro">Julio Castro</option>
                        <option value="Mashiel Campos">Mashiel Campos</option>
                        <option value="Yessica Huerta">Yessica Huerta</option>
                        <option value="Jezabel Monterrosas">Jezabel Monterrosas</option>
                        <option value="Karla Flores">Karla Flores</option>
                        <option value="Eduardo Aguila">Eduardo Aguila</option>
                        <option value="Luisa Meza">Luisa Meza</option>
                        <option value="Jonathan Tenorio">Jonathan Tenorio</option>
                        <option value="Jorge Ure√±a">Jorge Ure√±a</option>
                        <option value="Fernanda Martinez">Fernanda Martinez</option>
                        <option value="Reyna Martinez">Reyna Martinez</option>
                        <option value="Carlos Aguilar">Carlos Aguilar</option>
                        <option value="Alfredo Cabrera">Alfredo Cabrera</option>
                        <option value="Alan Salazar">Alan Salazar</option>
                        <option value="Invitado">Invitado</option>
                    </select>
                </div>
            </div>
            <div class="card fade-in" id="aspirantes-card" style="display: none;">
                <div class="card-title"><span class="icon">üìã</span>Aspirantes a Evaluar</div>
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid #0057B8; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #0057B8; margin-bottom: 12px; font-size: 15px;">üìò ¬øC√≥mo funciona la evaluaci√≥n panel?</h4>
                    <div style="font-size: 13px; color: #334155; line-height: 1.8;">
                        <p style="margin-bottom: 8px;">üë• <strong>M√∫ltiples evaluadores:</strong> Cada aspirante puede ser evaluado por varios miembros del panel de forma independiente. El sistema calcula el <strong>promedio de todas las evaluaciones</strong> para determinar el resultado final.</p>
                        <p style="margin-bottom: 8px;">üéØ <strong>Criterios de aprobaci√≥n (puntaje promedio):</strong></p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin: 8px 0 12px;">
                            <div style="background: white; padding: 8px 12px; border-radius: 8px; border-left: 4px solid #10B981;"><strong>üåü 73-80 pts:</strong> Excelente</div>
                            <div style="background: white; padding: 8px 12px; border-radius: 8px; border-left: 4px solid #22C55E;"><strong>‚úÖ 65-72 pts:</strong> Bien</div>
                            <div style="background: white; padding: 8px 12px; border-radius: 8px; border-left: 4px solid #F59E0B;"><strong>‚ö†Ô∏è 59-64 pts:</strong> Regular</div>
                            <div style="background: white; padding: 8px 12px; border-radius: 8px; border-left: 4px solid #EF4444;"><strong>‚ùå 0-58 pts:</strong> No aprob√≥</div>
                        </div>
                        <p style="margin-bottom: 8px;">üö´ <strong>Veto:</strong> Si cualquier evaluador marca VETO en "¬øLo quiero en mi equipo?" o "Energ√≠a para ventas", el aspirante <strong>no aprueba</strong> sin importar el puntaje.</p>
                        <p style="margin-bottom: 0;">‚è∞ <strong>Tiempo l√≠mite:</strong> La evaluaci√≥n de cada aspirante se cierra cuando inicia el horario de la siguiente cita. Una vez cerrada, ya no se puede evaluar.</p>
                    </div>
                </div>
                <div class="aspirantes-list" id="aspirantes-list"></div>
            </div>
        </div>

        <!-- Secci√≥n Evaluaci√≥n -->
        <div class="section" id="section-evaluacion">
            <div class="card fade-in">
                <div class="eval-aspirante-header">
                    <div class="eval-aspirante-info">
                        <div class="eval-aspirante-avatar" id="eval-avatar">JD</div>
                        <div class="eval-aspirante-details">
                            <h3 id="eval-nombre">Juan D√≠az</h3>
                            <p id="eval-info">Torre JV ‚Ä¢ 10:00</p>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="marcarNoSePresento()" style="background: rgba(255,255,255,0.2); border: none; color: white;">üö´ No se present√≥</button>
                </div>

                <!-- Desplegable Historial Completo -->
                <button id="btn-prefiltro-panel" onclick="togglePrefiltroPanelBtn()" style="display: none; width: 100%; background: linear-gradient(135deg, #7C3AED, #6D28D9); color: white; border: none; padding: 12px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 20px;">üìÇ Ver historial completo del aspirante ‚ñº</button>
                <div id="prefiltro-panel-content" style="display: none; background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border: 2px solid #7C3AED; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #5B21B6; margin-bottom: 15px; font-size: 15px;">üìÇ Historial Completo del Aspirante</h4>
                    <div id="prefiltro-panel-respuestas"></div>
                </div>

                <!-- Gu√≠a de rangos -->
                <div class="guide-box" id="guide-box" style="display: none;">
                    <div class="guide-box-title">üìä Gu√≠a de Rangos de Aprobaci√≥n</div>
                    <div class="guide-box-content">
                        <div class="guide-item green">
                            <div class="guide-item-score">73-80 pts</div>
                            <div class="guide-item-label">üåü Aprobado (excelente)</div>
                        </div>
                        <div class="guide-item green">
                            <div class="guide-item-score">65-72 pts</div>
                            <div class="guide-item-label">‚úÖ Aprobado (bien)</div>
                        </div>
                        <div class="guide-item yellow">
                            <div class="guide-item-score">59-64 pts</div>
                            <div class="guide-item-label">‚ö†Ô∏è Aprobado (regular)</div>
                        </div>
                        <div class="guide-item red">
                            <div class="guide-item-score">0-58 pts</div>
                            <div class="guide-item-label">‚ùå No aprob√≥</div>
                        </div>
                    </div>
                </div>

                <div class="eval-progress">
                    <div class="progress-bar"><div class="progress-fill" id="eval-progress-bar" style="width: 0%"></div></div>
                    <span class="progress-text" id="eval-progress-text">0/16</span>
                </div>

                <!-- Parte 1 -->
                <div class="eval-section">
                    <div class="eval-section-title">üìù Parte 1: Preguntas Iniciales</div>
                    <div class="eval-question">
                        <div class="eval-question-text">1. Presentaci√≥n cronometrada (3-5 min)</div>
                        <div class="eval-question-hint">"Pres√©ntate como si fuera tu primer d√≠a con el equipo."</div>
                        <div class="eval-guide"><strong>üìå No suma puntaje.</strong> Solo observa: presencia, seguridad y actitud inicial.</div>
                        <textarea id="q1-notas" placeholder="Notas sobre la presentaci√≥n..." style="width: 100%; padding: 12px; border: 2px solid var(--gray-200); border-radius: 10px; font-family: inherit; min-height: 80px; resize: vertical;"></textarea>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">2. Caso real de call center</div>
                        <div class="eval-question-hint">"Llevas 2 d√≠as sin vender y el supervisor te pide resultados. ¬øQu√© haces?"</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Se victimiza, culpa la base, excusas.<br>
                            <strong>‚ûñ 3:</strong> Respuesta gen√©rica, sin plan concreto.<br>
                            <strong>‚úÖ 4-5:</strong> Ajusta discurso, pide coaching, se responsabiliza, tiene plan de acci√≥n.
                        </div>
                        <div class="rating-scale" data-question="q2">
                            <button class="rating-btn" onclick="setRating('q2', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('q2', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('q2', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('q2', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('q2', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">3. Manejo de feedback frente a varios</div>
                        <div class="eval-question-hint">"Un supervisor te dice frente al equipo que tu cierre es d√©bil. ¬øC√≥mo reaccionas?"</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Se ofende, ego alto, se pone a la defensiva.<br>
                            <strong>‚ûñ 3:</strong> Acepta pero sin acci√≥n clara.<br>
                            <strong>‚úÖ 4-5:</strong> Madurez, agradece el feedback, pregunta c√≥mo mejorar, trabajo en equipo.
                        </div>
                        <div class="rating-scale" data-question="q3">
                            <button class="rating-btn" onclick="setRating('q3', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('q3', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('q3', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('q3', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('q3', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">4. "¬øPor qu√© no deber√≠amos contratarte?"</div>
                        <div class="eval-question-hint">Pregunta inc√≥moda pero poderosa.</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Se victimiza, no sabe qu√© decir, respuesta vac√≠a.<br>
                            <strong>‚ûñ 3:</strong> Respuesta gen√©rica tipo "soy perfeccionista".<br>
                            <strong>‚úÖ 4-5:</strong> Reconoce √°reas de mejora reales, usa debilidades como objetivos de crecimiento.
                        </div>
                        <div class="rating-scale" data-question="q4">
                            <button class="rating-btn" onclick="setRating('q4', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('q4', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('q4', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('q4', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('q4', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">5. Cultura y equipo</div>
                        <div class="eval-question-hint">"¬øQu√© actitud tuya suma a un equipo y cu√°l podr√≠a restar?"</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Respuestas de manual, no conoce sus defectos.<br>
                            <strong>‚ûñ 3:</strong> Respuesta honesta pero superficial.<br>
                            <strong>‚úÖ 4-5:</strong> Autoconocimiento real, respuestas genuinas, no las t√≠picas de entrevista.
                        </div>
                        <div class="rating-scale" data-question="q5">
                            <button class="rating-btn" onclick="setRating('q5', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('q5', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('q5', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('q5', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('q5', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">6. Responsabilidad vs Victimismo</div>
                        <div class="eval-question-hint">"Si despu√©s de un mes no vendes lo esperado, ¬øqu√© har√≠as antes de renunciar?"</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Renunciar√≠a, culpar√≠a al proceso, sin resiliencia.<br>
                            <strong>‚ûñ 3:</strong> Pedir√≠a ayuda pero sin plan propio.<br>
                            <strong>‚úÖ 4-5:</strong> Car√°cter, resiliencia, busca soluciones, se queda a luchar.
                        </div>
                        <div class="rating-scale" data-question="q6">
                            <button class="rating-btn" onclick="setRating('q6', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('q6', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('q6', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('q6', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('q6', 5)">5</button>
                        </div>
                    </div>
                </div>

                <!-- Parte 2 -->
                <div class="eval-section">
                    <div class="eval-section-title">üé≠ Parte 2: Roleplay (5 min)</div>
                    <p style="color: var(--gray-500); font-size: 13px; margin-bottom: 20px; padding: 12px; background: var(--gray-100); border-radius: 8px;">
                        üìã <strong>Escenario:</strong> "Llamas a un cliente con plan activo elegible para renovaci√≥n."<br>
                        ‚è±Ô∏è <strong>Preparaci√≥n:</strong> 30 seg | <strong>Ejecuci√≥n:</strong> 3 min<br>
                        üéØ <strong>Objetivo:</strong> No buscamos t√©cnica perfecta, sino ver c√≥mo piensa y reacciona bajo presi√≥n.
                    </p>
                    <div class="eval-question">
                        <div class="eval-question-text">7. Apertura (¬ørompe el hielo?)</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Inseguro, titubea, no sabe c√≥mo empezar.<br>
                            <strong>‚ûñ 3:</strong> Se presenta pero sin enganche.<br>
                            <strong>‚úÖ 4-5:</strong> Seguro, claro, buen tono, va al punto r√°pido.
                        </div>
                        <div class="rating-scale" data-question="r1">
                            <button class="rating-btn" onclick="setRating('r1', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('r1', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('r1', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('r1', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('r1', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">8. Estructura (¬øhay orden?)</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Habla sin rumbo, no hay secuencia l√≥gica.<br>
                            <strong>‚ûñ 3:</strong> Algo de orden pero se pierde.<br>
                            <strong>‚úÖ 4-5:</strong> Secuencia clara: Inicio ‚Üí Beneficio ‚Üí Intento de cierre.
                        </div>
                        <div class="rating-scale" data-question="r2">
                            <button class="rating-btn" onclick="setRating('r2', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('r2', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('r2', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('r2', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('r2', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">9. Comunicaci√≥n</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Se traba, habla muy bajo, no se entiende.<br>
                            <strong>‚ûñ 3:</strong> Se entiende pero sin firmeza.<br>
                            <strong>‚úÖ 4-5:</strong> Fluido, palabras simples, buen ritmo, se escucha firme.
                        </div>
                        <div class="rating-scale" data-question="r3">
                            <button class="rating-btn" onclick="setRating('r3', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('r3', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('r3', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('r3', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('r3', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">10. Intento de cierre (FUNDAMENTAL)</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Nunca intenta cerrar, solo informa.<br>
                            <strong>‚ûñ 3:</strong> Intento d√©bil o indirecto.<br>
                            <strong>‚úÖ 4-5:</strong> Lanza un cierre claro, aunque sea b√°sico. Pide la venta.
                        </div>
                        <div class="rating-scale" data-question="r4">
                            <button class="rating-btn" onclick="setRating('r4', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('r4', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('r4', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('r4', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('r4', 5)">5</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">11. Actitud bajo presi√≥n</div>
                        <div class="eval-guide">
                            <strong>‚ùå 1-2:</strong> Se bloquea, r√≠e nervioso, se rinde.<br>
                            <strong>‚ûñ 3:</strong> Se incomoda pero contin√∫a.<br>
                            <strong>‚úÖ 4-5:</strong> Mantiene compostura, maneja silencios, no se rinde.
                        </div>
                        <div class="rating-scale" data-question="r5">
                            <button class="rating-btn" onclick="setRating('r5', 1)">1</button>
                            <button class="rating-btn" onclick="setRating('r5', 2)">2</button>
                            <button class="rating-btn" onclick="setRating('r5', 3)">3</button>
                            <button class="rating-btn" onclick="setRating('r5', 4)">4</button>
                            <button class="rating-btn" onclick="setRating('r5', 5)">5</button>
                        </div>
                    </div>
                </div>

                <!-- Parte 3 -->
                <div class="eval-section">
                    <div class="eval-section-title">üéØ Parte 3: Decisi√≥n Post-Roleplay</div>
                    <div class="eval-question">
                        <div class="eval-question-text">12. ¬øIntent√≥ cerrar?</div>
                        <div class="eval-guide">üö® <strong>RED FLAG si NO:</strong> Un vendedor que no intenta cerrar no sirve para ventas.</div>
                        <div class="option-buttons" data-question="d1">
                            <button class="option-btn" onclick="setOption('d1', 'si', 5)">‚úÖ S√≠ (5 pts)</button>
                            <button class="option-btn" onclick="setOption('d1', 'no', 0)">‚ùå No (0 pts)</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">13. ¬øSe comunic√≥ con claridad?</div>
                        <div class="eval-guide">Eval√∫a si pudiste entender su mensaje sin esfuerzo.</div>
                        <div class="option-buttons" data-question="d2">
                            <button class="option-btn" onclick="setOption('d2', 'si', 5)">‚úÖ S√≠ (5 pts)</button>
                            <button class="option-btn" onclick="setOption('d2', 'no', 0)">‚ùå No (0 pts)</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">14. ¬øSu actitud suma o resta?</div>
                        <div class="eval-guide">
                            <strong>‚úÖ Suma:</strong> Se anim√≥, improvis√≥, mantuvo profesionalismo.<br>
                            <strong>‚ûñ Neutral:</strong> Ni sum√≥ ni rest√≥, pas√≥ desapercibido.<br>
                            <strong>‚ùå Resta:</strong> Se burl√≥, se quej√≥, culp√≥ al escenario.
                        </div>
                        <div class="option-buttons" data-question="d3">
                            <button class="option-btn" onclick="setOption('d3', 'suma', 5)">‚úÖ Suma (5)</button>
                            <button class="option-btn" onclick="setOption('d3', 'neutral', 3)">‚ûñ Neutral (3)</button>
                            <button class="option-btn" onclick="setOption('d3', 'resta', 0)">‚ùå Resta (0)</button>
                        </div>
                    </div>
                </div>

                <!-- Parte 4 -->
                <div class="eval-section">
                    <div class="eval-section-title">üèÜ Parte 4: Decisi√≥n del Panel</div>
                    <div class="eval-question">
                        <div class="eval-question-text">15. ¬øLo quiero en mi equipo?</div>
                        <div class="eval-guide">
                            <strong>‚ö†Ô∏è VETO:</strong> Si marcas "No", el candidato NO PASA aunque tenga buen puntaje.<br>
                            Piensa: ¬ølo pondr√≠as a trabajar contigo ma√±ana?
                        </div>
                        <div class="option-buttons" data-question="p1">
                            <button class="option-btn" onclick="setOption('p1', 'si', 5)">‚úÖ S√≠ (5)</button>
                            <button class="option-btn" onclick="setOption('p1', 'talvez', 3)">ü§î Tal vez (3)</button>
                            <button class="option-btn" onclick="setOption('p1', 'no', 0, true)">‚ùå No - VETO</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">16. ¬øTransmite responsabilidad?</div>
                        <div class="eval-guide">¬øSe har√≠a cargo de sus resultados o buscar√≠a excusas?</div>
                        <div class="option-buttons" data-question="p2">
                            <button class="option-btn" onclick="setOption('p2', 'si', 5)">‚úÖ S√≠ (5)</button>
                            <button class="option-btn" onclick="setOption('p2', 'neutral', 3)">‚ûñ Neutral (3)</button>
                            <button class="option-btn" onclick="setOption('p2', 'no', 0)">‚ùå No (0)</button>
                        </div>
                    </div>
                    <div class="eval-question">
                        <div class="eval-question-text">17. ¬øTiene energ√≠a para ventas?</div>
                        <div class="eval-guide">
                            <strong>‚ö†Ô∏è VETO:</strong> Si marcas "Baja", el candidato NO PASA.<br>
                            Ventas requiere energ√≠a constante. Sin energ√≠a, no hay ventas.
                        </div>
                        <div class="option-buttons" data-question="p3">
                            <button class="option-btn" onclick="setOption('p3', 'alta', 5)">üî• Alta (5)</button>
                            <button class="option-btn" onclick="setOption('p3', 'media', 3)">‚ûñ Media (3)</button>
                            <button class="option-btn" onclick="setOption('p3', 'baja', 0, true)">‚ùÑÔ∏è Baja - VETO</button>
                        </div>
                    </div>
                </div>

                <!-- ============================================= -->
                <!-- PREGUNTAS OBLIGATORIAS PARA EL PANELISTA      -->
                <!-- ============================================= -->
                <div class="panelist-questions" id="panelist-questions-section">
                    <div class="panelist-header">
                        <h4>üé§ Preguntas para ti, panelista</h4>
                        <p>Estas preguntas son para TI como evaluador. Contesta de manera objetiva y honesta bas√°ndote en lo que observaste durante la entrevista. Todas son obligatorias.</p>
                    </div>

                    <!-- Pregunta 1: Siempre visible -->
                    <div class="panelist-q">
                        <div class="panelist-q-label">
                            <span class="req">*</span>
                            <span>1. ¬øQu√© es lo que m√°s destacas del aspirante?</span>
                        </div>
                        <textarea id="pan-q1" class="panelist-textarea" placeholder="Escribe lo que m√°s te llam√≥ la atenci√≥n positivamente del candidato..." oninput="validarPreguntasPanelista()"></textarea>
                        <div class="field-hint" id="pan-q1-hint">Campo obligatorio ‚Äî s√© espec√≠fico y objetivo</div>
                    </div>

                    <!-- Pregunta 2: Siempre visible -->
                    <div class="panelist-q">
                        <div class="panelist-q-label">
                            <span class="req">*</span>
                            <span>2. ¬øCu√°l fue la red flag m√°s preocupante que detectaste?</span>
                        </div>
                        <textarea id="pan-q2" class="panelist-textarea" placeholder="Describe la se√±al de alerta m√°s importante que observaste..." oninput="validarPreguntasPanelista()"></textarea>
                        <div class="field-hint" id="pan-q2-hint">Campo obligatorio ‚Äî si no detectaste ninguna, explica por qu√©</div>
                    </div>

                    <!-- Pregunta 3: Condicional APROBADO -->
                    <div class="panelist-q conditional-q" id="pan-q3-approved-container">
                        <div class="conditional-q-approved">
                            <div class="panelist-q-label">
                                <span class="req">*</span>
                                <span>3. ¬øPor qu√© consideras APTO para AT&T al aspirante?</span>
                            </div>
                            <textarea id="pan-q3-approved" class="panelist-textarea" placeholder="Explica objetivamente por qu√© este candidato merece formar parte del equipo AT&T..." oninput="validarPreguntasPanelista()"></textarea>
                            <div class="field-hint" id="pan-q3-approved-hint">Campo obligatorio ‚Äî fundamenta tu decisi√≥n</div>
                        </div>
                    </div>

                    <!-- Pregunta 3: Condicional REPROBADO -->
                    <div class="panelist-q conditional-q" id="pan-q3-failed-container">
                        <div class="conditional-q-failed">
                            <div class="panelist-q-label">
                                <span class="req">*</span>
                                <span>3. ¬øPor qu√© NO consideras apto para AT&T al aspirante?</span>
                            </div>
                            <textarea id="pan-q3-failed" class="panelist-textarea" placeholder="Explica objetivamente por qu√© este candidato no deber√≠a formar parte del equipo AT&T..." oninput="validarPreguntasPanelista()"></textarea>
                            <div class="field-hint" id="pan-q3-failed-hint">Campo obligatorio ‚Äî fundamenta tu decisi√≥n</div>
                        </div>
                    </div>

                    <!-- Alerta de campos faltantes -->
                    <div class="missing-fields-alert" id="missing-fields-alert">
                        ‚ö†Ô∏è <span id="missing-fields-text">Debes completar todas las preguntas obligatorias para poder enviar la evaluaci√≥n.</span>
                    </div>
                </div>

                <!-- Resultado -->
                <div class="resultado-preview" id="resultado-preview">
                    <h3>PUNTAJE ACTUAL</h3>
                    <div class="resultado-score" id="resultado-score">0/80</div>
                    <div class="resultado-label" id="resultado-label" style="background: var(--gray-500);">Completa la evaluaci√≥n</div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="volverALista()">‚Üê Volver</button>
                    <button class="btn btn-primary" id="btn-enviar" disabled onclick="enviarEvaluacion()">Enviar Evaluaci√≥n ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Secci√≥n No Show -->
        <div class="section" id="section-noshow">
            <div class="card fade-in">
                <div class="no-show-container">
                    <div class="no-show-icon">üö´</div>
                    <h3>¬øConfirmas que no se present√≥?</h3>
                    <p id="noshow-nombre">Juan D√≠az</p>
                    <p style="font-size: 13px; color: var(--danger); margin-bottom: 20px;">‚ö†Ô∏è Esta acci√≥n bloquear√° al candidato para todos los evaluadores.</p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="volverAEvaluacion()">‚Üê Cancelar</button>
                        <button class="btn btn-danger" id="btn-noshow" onclick="confirmarNoShow()">Confirmar No Show</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n Confirmaci√≥n -->
        <div class="section" id="section-confirmacion">
            <div class="card fade-in">
                <div class="confirmation-screen">
                    <div class="confirmation-icon">‚úì</div>
                    <h2>¬°Evaluaci√≥n Enviada!</h2>
                    <p id="confirmacion-mensaje">Tu evaluaci√≥n ha sido registrada.</p>
                    <button class="btn btn-primary" onclick="evaluarOtro()">Evaluar otro aspirante ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script>
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby-HOsviZvkv83Lrsu6cFukqRK6uuft9nw438lxPv2WOX_prRx3CfosVF7-BxuwBJCQ9A/exec';

const EVALUADORES_CON_GUIA = ['Jonathan Tenorio', 'Pilar Garc√≠a'];

let selectedSucursal = null;
let selectedGrupo = null;
let selectedEvaluador = null;
let selectedAspirante = null;
let aspirantesList = [];
let horariosAspirantes = [];
let evaluaciones = {};
let vetos = [];
let intentoEnvio = false; // Para mostrar errores solo despu√©s del primer intento

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('user-badge').style.display = 'none';
});

function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0, 0);
}

function onSucursalChange() {
    selectedSucursal = document.getElementById('select-sucursal').value;
    if (selectedSucursal) {
        document.getElementById('grupo-container').style.display = 'block';
        cargarGrupos();
    } else {
        document.getElementById('grupo-container').style.display = 'none';
        document.getElementById('evaluador-container').style.display = 'none';
        document.getElementById('aspirantes-card').style.display = 'none';
    }
}

async function cargarGrupos() {
    const select = document.getElementById('select-grupo');
    select.innerHTML = '<option value="">Cargando...</option>';
    document.getElementById('evaluador-container').style.display = 'none';
    document.getElementById('aspirantes-card').style.display = 'none';
    try {
        const r = await fetch(GOOGLE_SCRIPT_URL + '?action=getGruposPanel&sucursal=' + encodeURIComponent(selectedSucursal));
        const data = await r.json();
        select.innerHTML = '<option value="">Selecciona un grupo</option>';
        if (data.grupos && data.grupos.length > 0) {
            data.grupos.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g.fecha;
                opt.textContent = g.fechaLegible;
                select.appendChild(opt);
            });
        } else {
            select.innerHTML = '<option value="">No hay grupos</option>';
        }
    } catch (e) {
        console.error(e);
        select.innerHTML = '<option value="">Error al cargar</option>';
    }
}

function onGrupoChange() {
    selectedGrupo = document.getElementById('select-grupo').value;
    if (selectedGrupo) {
        document.getElementById('evaluador-container').style.display = 'block';
    } else {
        document.getElementById('evaluador-container').style.display = 'none';
        document.getElementById('aspirantes-card').style.display = 'none';
    }
}

function onEvaluadorChange() {
    selectedEvaluador = document.getElementById('select-evaluador').value;
    if (selectedEvaluador) {
        document.getElementById('user-badge').style.display = 'flex';
        const iniciales = selectedEvaluador.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
        document.getElementById('badge-avatar').textContent = iniciales;
        document.getElementById('badge-name').textContent = selectedEvaluador;
        cargarAspirantes();
    } else {
        document.getElementById('user-badge').style.display = 'none';
        document.getElementById('aspirantes-card').style.display = 'none';
    }
}

async function cargarAspirantes() {
    if (!selectedSucursal || !selectedGrupo || !selectedEvaluador) return;
    const lista = document.getElementById('aspirantes-list');
    lista.innerHTML = '<p style="text-align:center;color:var(--gray-500);"><span class="loading loading-dark"></span> Cargando...</p>';
    document.getElementById('aspirantes-card').style.display = 'block';
    try {
        const r = await fetch(GOOGLE_SCRIPT_URL + '?action=getAspirantesPanel&sucursal=' + encodeURIComponent(selectedSucursal) + '&fecha=' + encodeURIComponent(selectedGrupo) + '&evaluador=' + encodeURIComponent(selectedEvaluador));
        const data = await r.json();
        aspirantesList = data.aspirantes || [];
        horariosAspirantes = aspirantesList.map(a => a.hora).sort();
        
        if (aspirantesList.length === 0) {
            lista.innerHTML = '<p style="text-align:center;color:var(--gray-500);">No hay aspirantes</p>';
            return;
        }
        
        const ahora = new Date();
        const horaActual = ahora.getHours() * 60 + ahora.getMinutes();
        
        lista.innerHTML = '';
        aspirantesList.forEach((asp, idx) => {
            const iniciales = asp.nombre.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
            let statusClass = 'status-pending', statusText = 'Pendiente', cardClass = '';
            let puedeEvaluar = true;
            
            if (asp.evaluadoPorMi) { 
                statusClass = 'status-evaluated'; 
                statusText = '‚úÖ Ya evaluado'; 
                cardClass = 'evaluated'; 
                puedeEvaluar = false;
            }
            if (asp.noSePresento) { 
                statusClass = 'status-noshow'; 
                statusText = 'üö´ No se present√≥'; 
                cardClass = 'no-show'; 
                puedeEvaluar = false;
            }
            
            const [h, m] = asp.hora.split(':').map(Number);
            const horaAspirante = h * 60 + m;
            const siguienteIdx = horariosAspirantes.findIndex(hora => {
                const [sh, sm] = hora.split(':').map(Number);
                return (sh * 60 + sm) > horaAspirante;
            });
            
            const hoyStr = ahora.toISOString().split('T')[0];
            const esFechaPasada = hoyStr > selectedGrupo;
            
            if (esFechaPasada && !asp.evaluadoPorMi) {
                statusClass = 'status-cerrado';
                statusText = 'üîí Cerrado (fecha pasada)';
                cardClass = 'cerrado';
                puedeEvaluar = false;
            } else if (siguienteIdx !== -1) {
                const [sh, sm] = horariosAspirantes[siguienteIdx].split(':').map(Number);
                const horaSiguiente = sh * 60 + sm;
                if (hoyStr === selectedGrupo && horaActual >= horaSiguiente && !asp.evaluadoPorMi) {
                    statusClass = 'status-cerrado';
                    statusText = 'üîí Cerrado';
                    cardClass = 'cerrado';
                    puedeEvaluar = false;
                }
            }

            let evalCountHTML = '';
            if (asp.numEvaluadores > 0) {
                evalCountHTML = '<span style="font-size: 11px; color: var(--gray-500); display: block;">üë• ' + asp.numEvaluadores + ' evaluador' + (asp.numEvaluadores > 1 ? 'es' : '') + '</span>';
            }
            
            const div = document.createElement('div');
            div.className = 'aspirante-card ' + cardClass;
            div.innerHTML = '<div class="aspirante-info"><div class="aspirante-avatar">' + iniciales + '</div><div class="aspirante-details"><h4>' + asp.nombre + '</h4><p>üïê ' + asp.hora + ' ‚Ä¢ ' + asp.estado + '</p>' + evalCountHTML + '</div></div><div style="display: flex; align-items: center; gap: 10px;">' + (asp.cvUrl ? '<button onclick="event.stopPropagation(); window.open(\'' + asp.cvUrl + '\', \'_blank\')" style="background: linear-gradient(135deg, #9333EA 0%, #7C3AED 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 500;">üìÑ CV</button>' : '') + '<span class="status-badge ' + statusClass + '">' + statusText + '</span></div>';
            
            if (puedeEvaluar) {
                div.onclick = () => iniciarEvaluacion(asp);
            }
            lista.appendChild(div);
        });
    } catch (e) {
        console.error(e);
        lista.innerHTML = '<p style="text-align:center;color:var(--danger);">Error al cargar</p>';
    }
}

function iniciarEvaluacion(asp) {
    selectedAspirante = asp;
    evaluaciones = {};
    vetos = [];
    intentoEnvio = false;
    
    const iniciales = asp.nombre.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
    document.getElementById('eval-avatar').textContent = iniciales;
    document.getElementById('eval-nombre').textContent = asp.nombre;
    document.getElementById('eval-info').textContent = selectedSucursal + ' ‚Ä¢ ' + asp.hora + ' ‚Ä¢ Evaluador: ' + selectedEvaluador;
    document.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('selected'));
    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected','selected-warning','selected-danger'));
    document.getElementById('q1-notas').value = '';
    
    // Limpiar preguntas del panelista
    document.getElementById('pan-q1').value = '';
    document.getElementById('pan-q2').value = '';
    document.getElementById('pan-q3-approved').value = '';
    document.getElementById('pan-q3-failed').value = '';
    ['pan-q1','pan-q2','pan-q3-approved','pan-q3-failed'].forEach(id => {
        const el = document.getElementById(id);
        el.classList.remove('field-error','field-valid');
    });
    ['pan-q1-hint','pan-q2-hint','pan-q3-approved-hint','pan-q3-failed-hint'].forEach(id => {
        const el = document.getElementById(id);
        el.className = 'field-hint';
        el.textContent = 'Campo obligatorio';
    });
    document.getElementById('pan-q1-hint').textContent = 'Campo obligatorio ‚Äî s√© espec√≠fico y objetivo';
    document.getElementById('pan-q2-hint').textContent = 'Campo obligatorio ‚Äî si no detectaste ninguna, explica por qu√©';
    document.getElementById('pan-q3-approved-hint').textContent = 'Campo obligatorio ‚Äî fundamenta tu decisi√≥n';
    document.getElementById('pan-q3-failed-hint').textContent = 'Campo obligatorio ‚Äî fundamenta tu decisi√≥n';
    
    // Ocultar preguntas condicionales
    document.getElementById('pan-q3-approved-container').classList.remove('visible');
    document.getElementById('pan-q3-failed-container').classList.remove('visible');
    document.getElementById('missing-fields-alert').classList.remove('visible');
    
    const guideBox = document.getElementById('guide-box');
    guideBox.style.display = EVALUADORES_CON_GUIA.includes(selectedEvaluador) ? 'block' : 'none';
    
    const btnEnviar = document.getElementById('btn-enviar');
    btnEnviar.disabled = true;
    btnEnviar.innerHTML = 'Enviar Evaluaci√≥n ‚Üí';
    
    // Cargar historial completo
    const btnPF = document.getElementById('btn-prefiltro-panel');
    const contenidoPF = document.getElementById('prefiltro-panel-respuestas');
    const contenedorPF = document.getElementById('prefiltro-panel-content');
    
    if (asp.respuestasPF) {
        let htmlHist = '';
        
        // === SECCI√ìN 1: DATOS DEL ASPIRANTE ===
        if (asp.respuestasPF.datosPersonales || asp.telefono || asp.estado) {
            htmlHist += '<div class="hist-section">';
            htmlHist += '<div class="hist-section-title hist-datos">üë§ Datos del Aspirante</div>';
            
            const datos = asp.respuestasPF.datosPersonales || {};
            const camposDatos = [
                { label: 'Nombre', valor: asp.nombre },
                { label: 'Tel√©fono', valor: asp.telefono || datos.telefono },
                { label: 'Estado/Ciudad', valor: datos.ciudad || asp.estado },
                { label: 'Edad', valor: datos.edad },
                { label: 'Escolaridad', valor: datos.escolaridad },
                { label: 'Experiencia en ventas', valor: datos.experienciaVentas },
                { label: 'Experiencia en call center', valor: datos.experienciaCC },
                { label: 'Disponibilidad', valor: datos.disponibilidad },
                { label: 'Fuente de reclutamiento', valor: datos.fuente },
                { label: 'Fecha de registro', valor: datos.fechaRegistro }
            ];
            camposDatos.forEach(c => {
                if (c.valor) {
                    htmlHist += '<div class="hist-item"><div class="hist-item-label">' + c.label + '</div><div class="hist-item-value">' + c.valor + '</div></div>';
                }
            });
            htmlHist += '</div>';
        }
        
        // === SECCI√ìN 2: PRE-FILTRO ===
        if (asp.respuestasPF.prefiltro) {
            htmlHist += '<div class="hist-section">';
            htmlHist += '<div class="hist-section-title hist-prefiltro">üìã Respuestas del Pre-Filtro</div>';
            
            if (asp.respuestasPF.prefiltroResultado) {
                htmlHist += '<div class="hist-item" style="border-left: 4px solid #F59E0B; font-weight: 600;">Resultado Pre-Filtro: ' + asp.respuestasPF.prefiltroResultado + '</div>';
            }
            if (asp.respuestasPF.prefiltroPuntaje) {
                htmlHist += '<div class="hist-item" style="border-left: 4px solid #F59E0B;">Puntaje: ' + asp.respuestasPF.prefiltroPuntaje + '</div>';
            }
            
            Object.values(asp.respuestasPF.prefiltro).forEach(function(r, idx) {
                htmlHist += '<div class="hist-item">' +
                    '<div class="hist-item-label">P' + (idx+1) + '. ' + r.pregunta + '</div>' +
                    '<div class="hist-item-value">' + (r.respuesta || 'Sin respuesta') + '</div>' +
                    '<div style="font-size: 11px; color: var(--gray-400); margin-top: 4px;">Puntaje: ' + r.puntaje + '/5</div>' +
                '</div>';
            });
            
            if (asp.respuestasPF.prefiltroObservaciones) {
                htmlHist += '<div class="hist-item" style="border-left: 4px solid #F59E0B; background: #FFFBEB;">' +
                    '<div class="hist-item-label">üìù Observaciones del Pre-Filtro</div>' +
                    '<div class="hist-item-value">' + asp.respuestasPF.prefiltroObservaciones + '</div>' +
                '</div>';
            }
            htmlHist += '</div>';
        }
        
        // === SECCI√ìN 3: ENTREVISTA TELEF√ìNICA ===
        if (asp.respuestasPF.entrevistaTel) {
            var et = asp.respuestasPF.entrevistaTel;
            htmlHist += '<div class="hist-section">';
            htmlHist += '<div class="hist-section-title hist-telefonica">üìû Entrevista Telef√≥nica ‚Äî ' + et.resultado + ' (' + et.puntajeTotal + '/30 pts)</div>';
            
            if (et.reclutadora) {
                htmlHist += '<div class="hist-item"><div class="hist-item-label">Reclutadora</div><div class="hist-item-value">' + et.reclutadora + '</div></div>';
            }
            if (et.fecha) {
                htmlHist += '<div class="hist-item"><div class="hist-item-label">Fecha de entrevista</div><div class="hist-item-value">' + et.fecha + '</div></div>';
            }
            
            var preguntas = [et.q1, et.q2, et.q3, et.q4, et.q5, et.q6];
            preguntas.forEach(function(r, idx) {
                if (r) {
                    htmlHist += '<div class="hist-item" style="border-left: 3px solid #7C3AED;">' +
                        '<div class="hist-item-label">Q' + (idx+1) + '. ' + r.pregunta + '</div>' +
                        '<div class="hist-item-value">' + (r.respuesta || 'Sin respuesta') + '</div>' +
                        '<div style="font-size: 11px; color: var(--gray-400); margin-top: 4px;">Puntaje: ' + r.puntaje + '/5</div>' +
                    '</div>';
                }
            });
            
            // Observaciones de la reclutadora
            if (et.observaciones) {
                htmlHist += '<div class="hist-item" style="border-left: 3px solid #7C3AED; background: #F5F3FF;">' +
                    '<div class="hist-item-label">üìù Observaciones de la reclutadora</div>' +
                    '<div class="hist-item-value">' + et.observaciones + '</div>' +
                '</div>';
            }
            
            // Preguntas de la reclutadora (lo que m√°s destaca, red flag, aptitud)
            if (et.preguntaDestaca) {
                htmlHist += '<div class="hist-item" style="border-left: 3px solid var(--success); background: #F0FDF4;">' +
                    '<div class="hist-item-label">‚≠ê Lo que m√°s destaca la reclutadora</div>' +
                    '<div class="hist-item-value">' + et.preguntaDestaca + '</div>' +
                '</div>';
            }
            if (et.preguntaRedFlag) {
                htmlHist += '<div class="hist-item" style="border-left: 3px solid var(--danger); background: #FFF5F5;">' +
                    '<div class="hist-item-label">üö© Red flag detectada por la reclutadora</div>' +
                    '<div class="hist-item-value">' + et.preguntaRedFlag + '</div>' +
                '</div>';
            }
            if (et.preguntaAptitud) {
                htmlHist += '<div class="hist-item" style="border-left: 3px solid #7C3AED; background: #F5F3FF;">' +
                    '<div class="hist-item-label">üìã Raz√≥n de aptitud/no aptitud seg√∫n reclutadora</div>' +
                    '<div class="hist-item-value">' + et.preguntaAptitud + '</div>' +
                '</div>';
            }
            
            htmlHist += '</div>';
        }
        
        contenidoPF.innerHTML = htmlHist;
        btnPF.style.display = 'block';
        contenedorPF.style.display = 'none';
    } else {
        btnPF.style.display = 'none';
        contenedorPF.style.display = 'none';
    }

    actualizarProgreso();
    showSection('section-evaluacion');
}

function setRating(q, v) {
    evaluaciones[q] = v;
    document.querySelectorAll('[data-question="'+q+'"] .rating-btn').forEach(b => b.classList.remove('selected'));
    event.target.classList.add('selected');
    actualizarProgreso();
}

function setOption(q, opt, pts, isVeto = false) {
    evaluaciones[q] = pts;
    if (isVeto) { if (!vetos.includes(q)) vetos.push(q); } else { vetos = vetos.filter(v => v !== q); }
    document.querySelectorAll('[data-question="'+q+'"] .option-btn').forEach(b => b.classList.remove('selected','selected-warning','selected-danger'));
    if (isVeto) event.target.classList.add('selected-danger');
    else if (pts === 3) event.target.classList.add('selected-warning');
    else event.target.classList.add('selected');
    actualizarProgreso();
}

function togglePrefiltroPanelBtn() {
    const contenedor = document.getElementById('prefiltro-panel-content');
    const btn = document.getElementById('btn-prefiltro-panel');
    if (contenedor.style.display === 'none') {
        contenedor.style.display = 'block';
        btn.textContent = 'üìÇ Ocultar historial del aspirante ‚ñ≤';
    } else {
        contenedor.style.display = 'none';
        btn.textContent = 'üìÇ Ver historial completo del aspirante ‚ñº';
    }
}

// Determina si el resultado actual es aprobatorio o no
function obtenerResultadoActual() {
    const preguntas = ['q2','q3','q4','q5','q6','r1','r2','r3','r4','r5','d1','d2','d3','p1','p2','p3'];
    const respondidas = preguntas.filter(q => evaluaciones[q] !== undefined).length;
    if (respondidas < preguntas.length) return 'incompleto';
    
    let puntaje = 0;
    preguntas.forEach(q => { if (evaluaciones[q] !== undefined) puntaje += evaluaciones[q]; });
    
    if (vetos.length > 0) return 'reprobado';
    if (puntaje >= 59) return 'aprobado';
    return 'reprobado';
}

function actualizarProgreso() {
    const preguntas = ['q2','q3','q4','q5','q6','r1','r2','r3','r4','r5','d1','d2','d3','p1','p2','p3'];
    const respondidas = preguntas.filter(q => evaluaciones[q] !== undefined).length;
    const porcentaje = (respondidas / preguntas.length) * 100;
    document.getElementById('eval-progress-bar').style.width = porcentaje + '%';
    document.getElementById('eval-progress-text').textContent = respondidas + '/' + preguntas.length;
    
    let puntaje = 0;
    preguntas.forEach(q => { if (evaluaciones[q] !== undefined) puntaje += evaluaciones[q]; });
    document.getElementById('resultado-score').textContent = puntaje + '/80';
    
    let resultado = '', colorStyle = '';
    if (respondidas < preguntas.length) { resultado = 'Completa la evaluaci√≥n'; colorStyle = 'background: var(--gray-500)'; }
    else if (vetos.length > 0) { resultado = '‚ùå No aprob√≥ (VETO)'; colorStyle = 'background: var(--danger)'; }
    else if (puntaje >= 73) { resultado = 'üåü Aprobado (excelente)'; colorStyle = 'background: var(--success)'; }
    else if (puntaje >= 65) { resultado = '‚úÖ Aprobado (bien)'; colorStyle = 'background: var(--success)'; }
    else if (puntaje >= 59) { resultado = '‚ö†Ô∏è Aprobado (regular)'; colorStyle = 'background: var(--warning)'; }
    else { resultado = '‚ùå No aprob√≥'; colorStyle = 'background: var(--danger)'; }
    
    document.getElementById('resultado-label').textContent = resultado;
    document.getElementById('resultado-label').style = colorStyle;
    
    // Mostrar/ocultar pregunta condicional seg√∫n resultado
    const res = obtenerResultadoActual();
    const approvedContainer = document.getElementById('pan-q3-approved-container');
    const failedContainer = document.getElementById('pan-q3-failed-container');
    
    if (res === 'aprobado') {
        approvedContainer.classList.add('visible');
        failedContainer.classList.remove('visible');
    } else if (res === 'reprobado') {
        approvedContainer.classList.remove('visible');
        failedContainer.classList.add('visible');
    } else {
        approvedContainer.classList.remove('visible');
        failedContainer.classList.remove('visible');
    }
    
    // Validar si se puede enviar
    const allQuestionsAnswered = respondidas >= preguntas.length;
    const panelistValid = validarPreguntasPanelista(false);
    document.getElementById('btn-enviar').disabled = !(allQuestionsAnswered && panelistValid);
}

// Valida las preguntas obligatorias del panelista
function validarPreguntasPanelista(mostrarErrores) {
    if (mostrarErrores === undefined) mostrarErrores = intentoEnvio;
    
    const q1 = document.getElementById('pan-q1').value.trim();
    const q2 = document.getElementById('pan-q2').value.trim();
    const res = obtenerResultadoActual();
    
    let campos = [
        { id: 'pan-q1', hintId: 'pan-q1-hint', valor: q1, defaultHint: 'Campo obligatorio ‚Äî s√© espec√≠fico y objetivo' },
        { id: 'pan-q2', hintId: 'pan-q2-hint', valor: q2, defaultHint: 'Campo obligatorio ‚Äî si no detectaste ninguna, explica por qu√©' }
    ];
    
    // Agregar campo condicional seg√∫n resultado
    if (res === 'aprobado') {
        const q3a = document.getElementById('pan-q3-approved').value.trim();
        campos.push({ id: 'pan-q3-approved', hintId: 'pan-q3-approved-hint', valor: q3a, defaultHint: 'Campo obligatorio ‚Äî fundamenta tu decisi√≥n' });
    } else if (res === 'reprobado') {
        const q3f = document.getElementById('pan-q3-failed').value.trim();
        campos.push({ id: 'pan-q3-failed', hintId: 'pan-q3-failed-hint', valor: q3f, defaultHint: 'Campo obligatorio ‚Äî fundamenta tu decisi√≥n' });
    }
    
    let todosValidos = true;
    let faltantes = 0;
    
    campos.forEach(c => {
        const el = document.getElementById(c.id);
        const hint = document.getElementById(c.hintId);
        const esValido = c.valor.length >= 10; // M√≠nimo 10 caracteres
        
        if (esValido) {
            el.classList.remove('field-error');
            el.classList.add('field-valid');
            hint.className = 'field-hint hint-ok';
            hint.textContent = '‚úì Respuesta registrada';
        } else if (mostrarErrores || c.valor.length > 0) {
            if (c.valor.length > 0 && c.valor.length < 10) {
                el.classList.add('field-error');
                el.classList.remove('field-valid');
                hint.className = 'field-hint hint-error';
                hint.textContent = '‚ö†Ô∏è M√≠nimo 10 caracteres ‚Äî faltan ' + (10 - c.valor.length);
            } else if (mostrarErrores) {
                el.classList.add('field-error');
                el.classList.remove('field-valid');
                hint.className = 'field-hint hint-error';
                hint.textContent = '‚ö†Ô∏è Este campo es obligatorio';
            }
            todosValidos = false;
            faltantes++;
        } else {
            el.classList.remove('field-error','field-valid');
            hint.className = 'field-hint';
            hint.textContent = c.defaultHint;
            todosValidos = false;
            faltantes++;
        }
    });
    
    // Si el resultado es incompleto, las preguntas condicionales no aplican a√∫n
    if (res === 'incompleto') {
        // Solo validar q1 y q2
        todosValidos = campos.slice(0,2).every(c => c.valor.length >= 10);
        // Pero no habilitar env√≠o porque faltan preguntas de evaluaci√≥n
    }
    
    const alert = document.getElementById('missing-fields-alert');
    if (mostrarErrores && !todosValidos) {
        alert.classList.add('visible');
        document.getElementById('missing-fields-text').textContent = 
            'Debes completar todas las preguntas obligatorias para poder enviar. ' + faltantes + ' campo' + (faltantes > 1 ? 's' : '') + ' pendiente' + (faltantes > 1 ? 's' : '') + '.';
    } else {
        alert.classList.remove('visible');
    }
    
    // Actualizar bot√≥n
    const preguntas = ['q2','q3','q4','q5','q6','r1','r2','r3','r4','r5','d1','d2','d3','p1','p2','p3'];
    const respondidas = preguntas.filter(q => evaluaciones[q] !== undefined).length;
    const allQuestionsAnswered = respondidas >= preguntas.length;
    document.getElementById('btn-enviar').disabled = !(allQuestionsAnswered && todosValidos);
    
    return todosValidos;
}

function marcarNoSePresento() {
    document.getElementById('noshow-nombre').textContent = selectedAspirante.nombre;
    const btn = document.getElementById('btn-noshow');
    btn.disabled = false;
    btn.innerHTML = 'Confirmar No Show';
    showSection('section-noshow');
}

function volverAEvaluacion() { showSection('section-evaluacion'); }
function volverALista() { showSection('section-config'); cargarAspirantes(); }

async function confirmarNoShow() {
    const btn = document.getElementById('btn-noshow');
    btn.disabled = true;
    btn.innerHTML = '<span class="loading"></span> Guardando...';
    const data = {
        tipo: 'evaluacion_panel_noshow',
        sucursal: selectedSucursal,
        fecha: selectedGrupo,
        evaluador: selectedEvaluador,
        aspirante_nombre: selectedAspirante.nombre,
        aspirante_telefono: selectedAspirante.telefono,
        resultado: 'No se present√≥',
        timestamp: new Date().toLocaleString('es-MX')
    };
    try {
        await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        document.getElementById('confirmacion-mensaje').textContent = 'Se registr√≥ que ' + selectedAspirante.nombre + ' no se present√≥.';
        showSection('section-confirmacion');
    } catch (e) {
        alert('Error. Intenta de nuevo.');
        btn.disabled = false;
        btn.innerHTML = 'Confirmar No Show';
    }
}

async function enviarEvaluacion() {
    intentoEnvio = true;
    
    // Validar preguntas del panelista con errores visibles
    if (!validarPreguntasPanelista(true)) {
        // Hacer scroll al primer campo con error
        const primerError = document.querySelector('.panelist-textarea.field-error');
        if (primerError) {
            primerError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            primerError.focus();
        }
        return;
    }
    
    const btn = document.getElementById('btn-enviar');
    btn.disabled = true;
    btn.innerHTML = '<span class="loading"></span> Enviando...';
    
    const preguntas = ['q2','q3','q4','q5','q6','r1','r2','r3','r4','r5','d1','d2','d3','p1','p2','p3'];
    let puntaje = 0;
    preguntas.forEach(q => { if (evaluaciones[q] !== undefined) puntaje += evaluaciones[q]; });
    
    let resultado = '';
    if (vetos.length > 0) resultado = 'No aprob√≥ (VETO)';
    else if (puntaje >= 73) resultado = 'Aprobado (excelente)';
    else if (puntaje >= 65) resultado = 'Aprobado (bien)';
    else if (puntaje >= 59) resultado = 'Aprobado (regular)';
    else resultado = 'No aprob√≥';
    
    const res = obtenerResultadoActual();
    const pregunta3 = res === 'aprobado' 
        ? document.getElementById('pan-q3-approved').value.trim() 
        : document.getElementById('pan-q3-failed').value.trim();
    
    const data = {
        tipo: 'evaluacion_panel',
        sucursal: selectedSucursal,
        fecha: selectedGrupo,
        evaluador: selectedEvaluador,
        aspirante_nombre: selectedAspirante.nombre,
        aspirante_telefono: selectedAspirante.telefono,
        q1_notas: document.getElementById('q1-notas').value,
        q2: evaluaciones.q2 || 0, q3: evaluaciones.q3 || 0, q4: evaluaciones.q4 || 0, q5: evaluaciones.q5 || 0, q6: evaluaciones.q6 || 0,
        r1: evaluaciones.r1 || 0, r2: evaluaciones.r2 || 0, r3: evaluaciones.r3 || 0, r4: evaluaciones.r4 || 0, r5: evaluaciones.r5 || 0,
        d1: evaluaciones.d1 || 0, d2: evaluaciones.d2 || 0, d3: evaluaciones.d3 || 0,
        p1: evaluaciones.p1 || 0, p2: evaluaciones.p2 || 0, p3: evaluaciones.p3 || 0,
        puntaje_total: puntaje,
        tiene_veto: vetos.length > 0,
        vetos: vetos.join(','),
        resultado: resultado,
        // Nuevos campos: preguntas obligatorias del panelista
        panelista_destaca: document.getElementById('pan-q1').value.trim(),
        panelista_redflag: document.getElementById('pan-q2').value.trim(),
        panelista_aptitud: pregunta3,
        panelista_aptitud_tipo: res === 'aprobado' ? 'apto' : 'no_apto',
        // Campo legacy por compatibilidad (combina las 3 respuestas)
        observaciones: '„ÄêDESTACA„Äë ' + document.getElementById('pan-q1').value.trim() + ' „ÄêRED FLAG„Äë ' + document.getElementById('pan-q2').value.trim() + ' „Äê' + (res === 'aprobado' ? 'APTO' : 'NO APTO') + '„Äë ' + pregunta3,
        timestamp: new Date().toLocaleString('es-MX')
    };
    
    try {
        await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        document.getElementById('confirmacion-mensaje').textContent = 'Tu evaluaci√≥n para ' + selectedAspirante.nombre + ' ha sido registrada. (' + selectedEvaluador + ')';
        showSection('section-confirmacion');
    } catch (e) {
        alert('Error. Intenta de nuevo.');
        btn.disabled = false;
        btn.innerHTML = 'Enviar Evaluaci√≥n ‚Üí';
    }
}

function evaluarOtro() { showSection('section-config'); cargarAspirantes(); }
</script>
</body>
</html>
